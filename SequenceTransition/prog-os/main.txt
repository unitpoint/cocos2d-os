
[FILE] raw://../prog-os/main.os
[1] var director = require("director")

begin function
  begin locals, total 3
    0 _E
    1 _G
    2 director
  end locals
  begin set local var
    begin call method
      get local var _E (0 0)
      begin params 2
        push const string "require"
        ,
        push const string "director"
      end params ret values 2
    end call method ret values 1
  end set local var director (2 0)


[3] print "Hello World!" // please see all printed messages here: assets-ram/output.txt

  begin call method
    get local var _E (0 0)
    begin params 2
      push const string "print"
      ,
      push const string "Hello World!"
    end params ret values 2
  end call method ret values 0


[5] MyScene = extends Scene {

  begin set env var
    begin extends
      get env var Scene
      begin object 1

[6] __construct = function(){

        begin set by name
          begin function
            begin locals, total 6
              0 _E
              1 _G
              2 bg
              3 base
              4 fan
              5 message
            end locals

[7] super() // call constructor of class we extend

            begin call
              super
              begin params 0
              end params ret values 0
            end call ret values 0


[9] var bg = Image("bg.jpg") 	// create background image

            begin set local var
              begin call method
                get local var _E (0 0)
                begin params 2
                  push const string "Image"
                  ,
                  push const string "bg.jpg"
                end params ret values 2
              end call method ret values 1
            end set local var bg (2 0)


[10] bg.x = this.width / 2		// locate it at center of scene

            begin set property
              begin operator /
                begin get property
                  push this
                  push const string "width"
                end get property ret values 1
                push const number 2
              end operator /
              get local var auto create bg (2 0)
              push const string "x"
            end set property ret values 0


[11] bg.y = this.height / 2

            begin set property
              begin operator /
                begin get property
                  push this
                  push const string "height"
                end get property ret values 1
                push const number 2
              end operator /
              get local var auto create bg (2 0)
              push const string "y"
            end set property ret values 0


[12] bg.scale = math.max(this.width / bg.width, this.height / bg.height)

            begin set property
              begin call method
                get env var math
                begin params 3
                  push const string "max"
                  ,
                  begin operator /
                    begin get property
                      push this
                      push const string "width"
                    end get property ret values 1
                    begin get property
                      get local var bg (2 0)
                      push const string "width"
                    end get property ret values 1
                  end operator /
                  ,
                  begin operator /
                    begin get property
                      push this
                      push const string "height"
                    end get property ret values 1
                    begin get property
                      get local var bg (2 0)
                      push const string "height"
                    end get property ret values 1
                  end operator /
                end params ret values 3
              end call method ret values 1
              get local var auto create bg (2 0)
              push const string "scale"
            end set property ret values 0


[13] this.insert(bg)				// insert the background image to the scene

            begin call method
              push this
              begin params 2
                push const string "insert"
                ,
                get local var bg (2 0)
              end params ret values 2
            end call method ret values 0


[15] var base = Image("base.png") // create base of fan

            begin set local var
              begin call method
                get local var _E (0 0)
                begin params 2
                  push const string "Image"
                  ,
                  push const string "base.png"
                end params ret values 2
              end call method ret values 1
            end set local var base (3 0)


[16] base.anchor = {x=0.5 y=0.95} // we want to use this anchor

            begin set property
              begin object 2
                begin set by name
                  push const number 0.5
                end set by name: [x]
                ,
                begin set by name
                  push const number 0.95
                end set by name: [y]
              end object
              get local var auto create base (3 0)
              push const string "anchor"
            end set property ret values 0


[17] base.x, base.y = 0, this.height // locate the base at left bottom corner

            begin set property
              begin set property
                begin params 2
                  push const number 0
                  ,
                  begin get property
                    push this
                    push const string "height"
                  end get property ret values 1
                end params ret values 2
                get local var auto create base (3 0)
                push const string "y"
              end set property ret values 1
              get local var auto create base (3 0)
              push const string "x"
            end set property ret values 0


[18] base.rotation = 45 // rotate it to 45 deg

            begin set property
              push const number 45
              get local var auto create base (3 0)
              push const string "rotation"
            end set property ret values 0


[19] this.insert(base)

            begin call method
              push this
              begin params 2
                push const string "insert"
                ,
                get local var base (3 0)
              end params ret values 2
            end call method ret values 0


[21] var fan = Image("fan.png") // create the fan

            begin set local var
              begin call method
                get local var _E (0 0)
                begin params 2
                  push const string "Image"
                  ,
                  push const string "fan.png"
                end params ret values 2
              end call method ret values 1
            end set local var fan (4 0)


[22] fan.x, fan.y = base.width/2, base.height*0.05 // locate it at top of the base

            begin set property
              begin set property
                begin params 2
                  begin operator /
                    begin get property
                      get local var base (3 0)
                      push const string "width"
                    end get property ret values 1
                    push const number 2
                  end operator /
                  ,
                  begin operator *
                    begin get property
                      get local var base (3 0)
                      push const string "height"
                    end get property ret values 1
                    push const number 0.05
                  end operator *
                end params ret values 2
                get local var auto create fan (4 0)
                push const string "y"
              end set property ret values 1
              get local var auto create fan (4 0)
              push const string "x"
            end set property ret values 0


[23] base.insert(fan) // insert the fan to the base

            begin call method
              get local var base (3 0)
              begin params 2
                push const string "insert"
                ,
                get local var fan (4 0)
              end params ret values 2
            end call method ret values 0


[27] fan.transition { // start rotation transition of the fan

            begin call method
              get local var fan (4 0)
              begin params 2
                push const string "transition"
                ,
                begin object 4

[28] rotation = 360*2 // rotate to 720 degs

                  begin set by name
                    push const number 720
                  end set by name: [rotation]
                  ,

[29] duration = 3.5	 // in 2.5 seconds

                  begin set by name
                    push const number 3.5
                  end set by name: [duration]
                  ,

[30] easy = Easy.outBack // use non linear transition

                  begin set by name
                    begin get property
                      get env var Easy
                      push const string "outBack"
                    end get property ret values 1
                  end set by name: [easy]
                  ,

[31] repeat = true // repeat it forever

                  begin set by name
                    const true
                  end set by name: [repeat]
                end object
              end params ret values 2
            end call method ret values 0


[34] base.transition { // start transition of the base

            begin call method
              get local var base (3 0)
              begin params 2
                push const string "transition"
                ,
                begin object 3

[35] sequence = { { // describe the transition sequence

                  begin set by name
                    begin object 4
                      begin set auto index
                        begin object 5

[36] x = this.width	// move the base to x

                          begin set by name
                            begin get property
                              push this
                              push const string "width"
                            end get property ret values 1
                          end set by name: [x]
                          ,

[37] y = this.height // move the base to y

                          begin set by name
                            begin get property
                              push this
                              push const string "height"
                            end get property ret values 1
                          end set by name: [y]
                          ,

[38] rotation = -45	// rotate to -45 deg

                          begin set by name
                            begin neg
                              push const number 45
                            end neg
                          end set by name: [rotation]
                          ,

[39] duration = 2	// in 2 seconds

                          begin set by name
                            push const number 2
                          end set by name: [duration]
                          ,

[40] easy = Easy.inOutBack // use non linear transition of this part of sequence

                          begin set by name
                            begin get property
                              get env var Easy
                              push const string "inOutBack"
                            end get property ret values 1
                          end set by name: [easy]
                        end object
                      end set auto index
                      ,

[41] }, {

                      begin set auto index
                        begin object 5

[42] x = this.width

                          begin set by name
                            begin get property
                              push this
                              push const string "width"
                            end get property ret values 1
                          end set by name: [x]
                          ,

[43] y = 0

                          begin set by name
                            push const number 0
                          end set by name: [y]
                          ,

[44] rotation = -135

                          begin set by name
                            begin neg
                              push const number 135
                            end neg
                          end set by name: [rotation]
                          ,

[45] duration = 2

                          begin set by name
                            push const number 2
                          end set by name: [duration]
                          ,

[46] easy = Easy.inOutExpo // use non linear transition of this part of sequence

                          begin set by name
                            begin get property
                              get env var Easy
                              push const string "inOutExpo"
                            end get property ret values 1
                          end set by name: [easy]
                        end object
                      end set auto index
                      ,

[47] }, {

                      begin set auto index
                        begin object 5

[48] x = 0

                          begin set by name
                            push const number 0
                          end set by name: [x]
                          ,

[49] y = 0

                          begin set by name
                            push const number 0
                          end set by name: [y]
                          ,

[50] rotation = -225

                          begin set by name
                            begin neg
                              push const number 225
                            end neg
                          end set by name: [rotation]
                          ,

[51] duration = 2

                          begin set by name
                            push const number 2
                          end set by name: [duration]
                          ,

[52] easy = Easy.outBounce // use non linear transition of this part of sequence

                          begin set by name
                            begin get property
                              get env var Easy
                              push const string "outBounce"
                            end get property ret values 1
                          end set by name: [easy]
                        end object
                      end set auto index
                      ,

[53] }, {

                      begin set auto index
                        begin object 4

[54] x = base.x

                          begin set by name
                            begin get property
                              get local var base (3 0)
                              push const string "x"
                            end get property ret values 1
                          end set by name: [x]
                          ,

[55] y = base.y

                          begin set by name
                            begin get property
                              get local var base (3 0)
                              push const string "y"
                            end get property ret values 1
                          end set by name: [y]
                          ,

[56] rotation = base.rotation

                          begin set by name
                            begin get property
                              get local var base (3 0)
                              push const string "rotation"
                            end get property ret values 1
                          end set by name: [rotation]
                          ,

[57] duration = 2

                          begin set by name
                            push const number 2
                          end set by name: [duration]
                        end object
                      end set auto index
                    end object
                  end set by name: [sequence]
                  ,

[60] alignRotation = true // use auto align rotation, comment this line to view difference

                  begin set by name
                    const true
                  end set by name: [alignRotation]
                  ,

[61] repeat = true // repeat it forever

                  begin set by name
                    const true
                  end set by name: [repeat]
                end object
              end params ret values 2
            end call method ret values 0


[64] var message = Text("Sequence Transition")	// create message

            begin set local var
              begin call method
                get local var _E (0 0)
                begin params 2
                  push const string "Text"
                  ,
                  push const string "Sequence Transition"
                end params ret values 2
              end call method ret values 1
            end set local var message (5 0)


[65] message.x = this.width	// locate the message at right bottom corner

            begin set property
              begin get property
                push this
                push const string "width"
              end get property ret values 1
              get local var auto create message (5 0)
              push const string "x"
            end set property ret values 0


[66] message.y = this.height

            begin set property
              begin get property
                push this
                push const string "height"
              end get property ret values 1
              get local var auto create message (5 0)
              push const string "y"
            end set property ret values 0


[67] message.anchor = {x=1.05 y=1.05}

            begin set property
              begin object 2
                begin set by name
                  push const number 1.05
                end set by name: [x]
                ,
                begin set by name
                  push const number 1.05
                end set by name: [y]
              end object
              get local var auto create message (5 0)
              push const string "anchor"
            end set property ret values 0


[68] message.shadow = true	// we want shadow enabled

            begin set property
              const true
              get local var auto create message (5 0)
              push const string "shadow"
            end set property ret values 0


[69] this.insert(message)

            begin call method
              push this
              begin params 2
                push const string "insert"
                ,
                get local var message (5 0)
              end params ret values 2
            end call method ret values 0
          end function
        end set by name: [__construct]
      end object
    end extends ret values 1
  end set env var MyScene


[73] director.scene = MyScene()	// create and set our game scene

  begin set property
    begin call method
      get local var _E (0 0)
      begin params 1
        push const string "MyScene"
      end params ret values 1
    end call method ret values 1
    get local var auto create director (2 0)
    push const string "scene"
  end set property ret values 0

  begin code list
    begin return
      get local var _E (0 0)
    end return values 1
  end code list ret values 0
end function
