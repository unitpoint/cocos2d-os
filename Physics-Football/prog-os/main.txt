
[FILE] raw://../prog-os/main.os
[1] var director = require("director")

begin function
  begin locals, total 4
    0 _E
    1 _G
    2 director
    3 physics
  end locals
  begin set local var
    begin call method
      get local var _E (0 0)
      begin params 2
        push const string "require"
        ,
        push const string "director"
      end params ret values 2
    end call method ret values 1
  end set local var director (2 0)


[2] var physics = require("physics")

  begin set local var
    begin call method
      get local var _E (0 0)
      begin params 2
        push const string "require"
        ,
        push const string "physics"
      end params ret values 2
    end call method ret values 1
  end set local var physics (3 0)


[4] print "Hello World!" // please see all printed messages here: assets-ram/output.txt

  begin call method
    get local var _E (0 0)
    begin params 2
      push const string "print"
      ,
      push const string "Hello World!"
    end params ret values 2
  end call method ret values 0


[6] MyScene = extends Scene {

  begin set env var
    begin extends
      get env var Scene
      begin object 1

[7] __construct = function(){

        begin set by name
          begin function
            begin locals, total 13
              0 _E
              1 _G
              2 bg
              3 bounce
              4 staticWalls
              5 Ball
              6 colors
              12 message
            end locals

[8] super() // call constructor of class we extend

            begin call
              super
              begin params 0
              end params ret values 0
            end call ret values 0


[10] var bg = Image("bg.jpg") 	// create background image

            begin set local var
              begin call method
                get local var _E (0 0)
                begin params 2
                  push const string "Image"
                  ,
                  push const string "bg.jpg"
                end params ret values 2
              end call method ret values 1
            end set local var bg (2 0)


[11] bg.x = this.width / 2		// locate it at center of scene

            begin set property
              begin operator /
                begin get property
                  push this
                  push const string "width"
                end get property ret values 1
                push const number 2
              end operator /
              get local var auto create bg (2 0)
              push const string "x"
            end set property ret values 0


[12] bg.y = this.height / 2

            begin set property
              begin operator /
                begin get property
                  push this
                  push const string "height"
                end get property ret values 1
                push const number 2
              end operator /
              get local var auto create bg (2 0)
              push const string "y"
            end set property ret values 0


[13] bg.scale = math.max(this.width / bg.width, this.height / bg.height)

            begin set property
              begin call method
                get env var math
                begin params 3
                  push const string "max"
                  ,
                  begin operator /
                    begin get property
                      push this
                      push const string "width"
                    end get property ret values 1
                    begin get property
                      get local var bg (2 0)
                      push const string "width"
                    end get property ret values 1
                  end operator /
                  ,
                  begin operator /
                    begin get property
                      push this
                      push const string "height"
                    end get property ret values 1
                    begin get property
                      get local var bg (2 0)
                      push const string "height"
                    end get property ret values 1
                  end operator /
                end params ret values 3
              end call method ret values 1
              get local var auto create bg (2 0)
              push const string "scale"
            end set property ret values 0


[14] this.insert(bg)				// insert the background image to the scene

            begin call method
              push this
              begin params 2
                push const string "insert"
                ,
                get local var bg (2 0)
              end params ret values 2
            end call method ret values 0


[16] var bounce = 0.9

            begin set local var
              push const number 0.9
            end set local var bounce (3 0)


[17] var staticWalls = physics.createBody { // make solid static shapes outside of the screen

            begin set local var
              begin call method
                get local var physics (3 1)
                begin params 2
                  push const string "createBody"
                  ,
                  begin object 2

[18] type = "static"

                    begin set by name
                      push const string "static"
                    end set by name: [type]
                    ,

[19] fixture = {

                    begin set by name
                      begin object 2

[20] shapes = [

                        begin set by name
                          begin array 4

[21] physics.getBoxShapeVertices([0, director.contentHeight], [director.contentWidth, director.contentHeight*0.1]),

                            begin set auto index
                              begin call method
                                get local var physics (3 1)
                                begin params 3
                                  push const string "getBoxShapeVertices"
                                  ,
                                  begin array 2
                                    begin set auto index
                                      push const number 0
                                    end set auto index
                                    ,
                                    begin set auto index
                                      begin get property
                                        get local var director (2 1)
                                        push const string "contentHeight"
                                      end get property ret values 1
                                    end set auto index
                                  end array
                                  ,
                                  begin array 2
                                    begin set auto index
                                      begin get property
                                        get local var director (2 1)
                                        push const string "contentWidth"
                                      end get property ret values 1
                                    end set auto index
                                    ,
                                    begin set auto index
                                      begin operator *
                                        begin get property
                                          get local var director (2 1)
                                          push const string "contentHeight"
                                        end get property ret values 1
                                        push const number 0.1
                                      end operator *
                                    end set auto index
                                  end array
                                end params ret values 3
                              end call method ret values 1
                            end set auto index
                            ,

[22] physics.getBoxShapeVertices([0, director.contentHeight*-0.1], [director.contentWidth, director.contentHeight*0.1]),

                            begin set auto index
                              begin call method
                                get local var physics (3 1)
                                begin params 3
                                  push const string "getBoxShapeVertices"
                                  ,
                                  begin array 2
                                    begin set auto index
                                      push const number 0
                                    end set auto index
                                    ,
                                    begin set auto index
                                      begin operator *
                                        begin get property
                                          get local var director (2 1)
                                          push const string "contentHeight"
                                        end get property ret values 1
                                        begin neg
                                          push const number 0.1
                                        end neg
                                      end operator *
                                    end set auto index
                                  end array
                                  ,
                                  begin array 2
                                    begin set auto index
                                      begin get property
                                        get local var director (2 1)
                                        push const string "contentWidth"
                                      end get property ret values 1
                                    end set auto index
                                    ,
                                    begin set auto index
                                      begin operator *
                                        begin get property
                                          get local var director (2 1)
                                          push const string "contentHeight"
                                        end get property ret values 1
                                        push const number 0.1
                                      end operator *
                                    end set auto index
                                  end array
                                end params ret values 3
                              end call method ret values 1
                            end set auto index
                            ,

[23] physics.getBoxShapeVertices([director.contentWidth*-0.1, 0], [director.contentWidth*0.1, director.contentHeight]),

                            begin set auto index
                              begin call method
                                get local var physics (3 1)
                                begin params 3
                                  push const string "getBoxShapeVertices"
                                  ,
                                  begin array 2
                                    begin set auto index
                                      begin operator *
                                        begin get property
                                          get local var director (2 1)
                                          push const string "contentWidth"
                                        end get property ret values 1
                                        begin neg
                                          push const number 0.1
                                        end neg
                                      end operator *
                                    end set auto index
                                    ,
                                    begin set auto index
                                      push const number 0
                                    end set auto index
                                  end array
                                  ,
                                  begin array 2
                                    begin set auto index
                                      begin operator *
                                        begin get property
                                          get local var director (2 1)
                                          push const string "contentWidth"
                                        end get property ret values 1
                                        push const number 0.1
                                      end operator *
                                    end set auto index
                                    ,
                                    begin set auto index
                                      begin get property
                                        get local var director (2 1)
                                        push const string "contentHeight"
                                      end get property ret values 1
                                    end set auto index
                                  end array
                                end params ret values 3
                              end call method ret values 1
                            end set auto index
                            ,

[24] physics.getBoxShapeVertices([director.contentWidth, 0], [director.contentWidth*0.1, director.contentHeight]),

                            begin set auto index
                              begin call method
                                get local var physics (3 1)
                                begin params 3
                                  push const string "getBoxShapeVertices"
                                  ,
                                  begin array 2
                                    begin set auto index
                                      begin get property
                                        get local var director (2 1)
                                        push const string "contentWidth"
                                      end get property ret values 1
                                    end set auto index
                                    ,
                                    begin set auto index
                                      push const number 0
                                    end set auto index
                                  end array
                                  ,
                                  begin array 2
                                    begin set auto index
                                      begin operator *
                                        begin get property
                                          get local var director (2 1)
                                          push const string "contentWidth"
                                        end get property ret values 1
                                        push const number 0.1
                                      end operator *
                                    end set auto index
                                    ,
                                    begin set auto index
                                      begin get property
                                        get local var director (2 1)
                                        push const string "contentHeight"
                                      end get property ret values 1
                                    end set auto index
                                  end array
                                end params ret values 3
                              end call method ret values 1
                            end set auto index
                          end array
                        end set by name: [shapes]
                        ,

[26] bounce = bounce

                        begin set by name
                          get local var bounce (3 0)
                        end set by name: [bounce]
                      end object
                    end set by name: [fixture]
                  end object
                end params ret values 2
              end call method ret values 1
            end set local var staticWalls (4 0)


[31] var Ball = extends Image {

            begin set local var
              begin extends
                get env var Image
                begin object 1

[32] __construct = function(imageFilename){

                  begin set by name
                    begin function
                      begin locals, total 9
                        0 imageFilename (param)
                        1 _E
                        2 _G
                        3 body
                        4 speedX
                        5 speedY
                        6 prevX
                        7 prevY
                        8 trackVelocity
                      end locals

[33] super(imageFilename || "ball.png") // call constructor of Image class

                      begin call
                        super
                        begin params 1
                          begin logic ||
                            get local var imageFilename (0 0 param)
                            push const string "ball.png"
                          end logic ||
                        end params ret values 1
                      end call ret values 0


[35] var body = this.addPhysicsBody { // add physics body to the ball

                      begin set local var
                        begin call method
                          push this
                          begin params 2
                            push const string "addPhysicsBody"
                            ,
                            begin object 2

[36] type = "dynamic"

                              begin set by name
                                push const string "dynamic"
                              end set by name: [type]
                              ,

[37] fixture = {

                              begin set by name
                                begin object 2

[38] radius = this.width/2

                                  begin set by name
                                    begin operator /
                                      begin get property
                                        push this
                                        push const string "width"
                                      end get property ret values 1
                                      push const number 2
                                    end operator /
                                  end set by name: [radius]
                                  ,

[39] bounce = bounce

                                  begin set by name
                                    get local var bounce (3 1)
                                  end set by name: [bounce]
                                end object
                              end set by name: [fixture]
                            end object
                          end params ret values 2
                        end call method ret values 1
                      end set local var body (3 0)


[43] body.angularVelocity = math.rad(math.random(-720, 720))

                      begin set property
                        begin call method
                          get env var math
                          begin params 2
                            push const string "rad"
                            ,
                            begin call method
                              get env var math
                              begin params 3
                                push const string "random"
                                ,
                                begin neg
                                  push const number 720
                                end neg
                                ,
                                push const number 720
                              end params ret values 3
                            end call method ret values 1
                          end params ret values 2
                        end call method ret values 1
                        get local var auto create body (3 0)
                        push const string "angularVelocity"
                      end set property ret values 0


[45] body.linearVelocity = [director.contentWidth * math.random(-1, 1), director.contentWidth * math.random(-1, 1)]

                      begin set property
                        begin array 2
                          begin set auto index
                            begin operator *
                              begin get property
                                get local var director (2 2)
                                push const string "contentWidth"
                              end get property ret values 1
                              begin call method
                                get env var math
                                begin params 3
                                  push const string "random"
                                  ,
                                  begin neg
                                    push const number 1
                                  end neg
                                  ,
                                  push const number 1
                                end params ret values 3
                              end call method ret values 1
                            end operator *
                          end set auto index
                          ,
                          begin set auto index
                            begin operator *
                              begin get property
                                get local var director (2 2)
                                push const string "contentWidth"
                              end get property ret values 1
                              begin call method
                                get env var math
                                begin params 3
                                  push const string "random"
                                  ,
                                  begin neg
                                    push const number 1
                                  end neg
                                  ,
                                  push const number 1
                                end params ret values 3
                              end call method ret values 1
                            end operator *
                          end set auto index
                        end array
                        get local var auto create body (3 0)
                        push const string "linearVelocity"
                      end set property ret values 0


[48] var speedX, speedY, prevX, prevY = 0, 0, 0, 0

                      begin set local var
                        begin set local var
                          begin set local var
                            begin set local var
                              begin params 4
                                push const number 0
                                ,
                                push const number 0
                                ,
                                push const number 0
                                ,
                                push const number 0
                              end params ret values 4
                            end set local var prevY (7 0)
                          end set local var prevX (6 0)
                        end set local var speedY (5 0)
                      end set local var speedX (4 0)


[49] var function trackVelocity(params){	// track velocity while dragging

                      begin set local var
                        begin function
                          begin locals, total 3
                            0 params (param)
                            1 _E
                            2 _G
                          end locals

[50] speedX = (this.x - prevX) / params.deltaTime

                          begin set local var
                            begin operator /
                              begin operator -
                                begin get property
                                  push this
                                  push const string "x"
                                end get property ret values 1
                                get local var prevX (6 1)
                              end operator -
                              begin get property
                                get local var params (0 0 param)
                                push const string "deltaTime"
                              end get property ret values 1
                            end operator /
                          end set local var speedX (4 1)


[51] speedY = (this.y - prevY) / params.deltaTime

                          begin set local var
                            begin operator /
                              begin operator -
                                begin get property
                                  push this
                                  push const string "y"
                                end get property ret values 1
                                get local var prevY (7 1)
                              end operator -
                              begin get property
                                get local var params (0 0 param)
                                push const string "deltaTime"
                              end get property ret values 1
                            end operator /
                          end set local var speedY (5 1)


[52] prevX, prevY = this.x, this.y

                          begin set local var
                            begin set local var
                              begin params 2
                                begin get property
                                  push this
                                  push const string "x"
                                end get property ret values 1
                                ,
                                begin get property
                                  push this
                                  push const string "y"
                                end get property ret values 1
                              end params ret values 2
                            end set local var prevY (7 1)
                          end set local var prevX (6 1)


[53] body.linearVelocity = [0, 0] // clear linearVelocity while dragging

                          begin set property
                            begin array 2
                              begin set auto index
                                push const number 0
                              end set auto index
                              ,
                              begin set auto index
                                push const number 0
                              end set auto index
                            end array
                            get local var auto create body (3 1)
                            push const string "linearVelocity"
                          end set property ret values 0


[54] body.gravityScale = 0 // clear gravityScale while dragging

                          begin set property
                            push const number 0
                            get local var auto create body (3 1)
                            push const string "gravityScale"
                          end set property ret values 0
                        end function
                      end set local var trackVelocity (8 0)


[57] this.addEventListener("touch", function(touch){	// add touch behavior

                      begin call method
                        push this
                        begin params 3
                          push const string "addEventListener"
                          ,
                          push const string "touch"
                          ,
                          begin function
                            begin locals, total 3
                              0 touch (param)
                              1 _E
                              2 _G
                            end locals

[58] if(touch.phase == "start"){

                            begin if
                              begin bool exp
                                begin logic ==
                                  begin get property
                                    get local var touch (0 0 param)
                                    push const string "phase"
                                  end get property ret values 1
                                  push const string "start"
                                end logic ==
                              end bool exp
                              begin then

[59] this.x0, this.y0 = touch.x - this.x, touch.y - this.y

                                begin scope
                                  begin set property
                                    begin set property
                                      begin params 2
                                        begin operator -
                                          begin get property
                                            get local var touch (0 0 param)
                                            push const string "x"
                                          end get property ret values 1
                                          begin get property
                                            push this
                                            push const string "x"
                                          end get property ret values 1
                                        end operator -
                                        ,
                                        begin operator -
                                          begin get property
                                            get local var touch (0 0 param)
                                            push const string "y"
                                          end get property ret values 1
                                          begin get property
                                            push this
                                            push const string "y"
                                          end get property ret values 1
                                        end operator -
                                      end params ret values 2
                                      push this
                                      push const string "y0"
                                    end set property ret values 1
                                    push this
                                    push const string "x0"
                                  end set property ret values 0


[60] this.addEventListener("enterFrame", trackVelocity)

                                  begin call method
                                    push this
                                    begin params 3
                                      push const string "addEventListener"
                                      ,
                                      push const string "enterFrame"
                                      ,
                                      get local var trackVelocity (8 1)
                                    end params ret values 3
                                  end call method ret values 0
                                end scope ret values 0
                              end then
                              begin else

[61] }else if(touch.phase == "move"){

                                begin if
                                  begin bool exp
                                    begin logic ==
                                      begin get property
                                        get local var touch (0 0 param)
                                        push const string "phase"
                                      end get property ret values 1
                                      push const string "move"
                                    end logic ==
                                  end bool exp
                                  begin then

[62] this.x, this.y = touch.x - this.x0, touch.y - this.y0

                                    begin scope
                                      begin set property
                                        begin set property
                                          begin params 2
                                            begin operator -
                                              begin get property
                                                get local var touch (0 0 param)
                                                push const string "x"
                                              end get property ret values 1
                                              begin get property
                                                push this
                                                push const string "x0"
                                              end get property ret values 1
                                            end operator -
                                            ,
                                            begin operator -
                                              begin get property
                                                get local var touch (0 0 param)
                                                push const string "y"
                                              end get property ret values 1
                                              begin get property
                                                push this
                                                push const string "y0"
                                              end get property ret values 1
                                            end operator -
                                          end params ret values 2
                                          push this
                                          push const string "y"
                                        end set property ret values 1
                                        push this
                                        push const string "x"
                                      end set property ret values 0
                                    end scope ret values 0
                                  end then
                                  begin else

[63] }else if(touch.phase == "end" || touch.phase == "cancel"){

                                    begin if
                                      begin bool exp
                                        begin logic ||
                                          begin logic ==
                                            begin get property
                                              get local var touch (0 0 param)
                                              push const string "phase"
                                            end get property ret values 1
                                            push const string "end"
                                          end logic ==
                                          begin logic ==
                                            begin get property
                                              get local var touch (0 0 param)
                                              push const string "phase"
                                            end get property ret values 1
                                            push const string "cancel"
                                          end logic ==
                                        end logic ||
                                      end bool exp
                                      begin then

[64] body.linearVelocity = [speedX, speedY] // set speed after dragging

                                        begin scope
                                          begin set property
                                            begin array 2
                                              begin set auto index
                                                get local var speedX (4 1)
                                              end set auto index
                                              ,
                                              begin set auto index
                                                get local var speedY (5 1)
                                              end set auto index
                                            end array
                                            get local var auto create body (3 1)
                                            push const string "linearVelocity"
                                          end set property ret values 0


[65] body.gravityScale = 1 // reset gravityScale to 1

                                          begin set property
                                            push const number 1
                                            get local var auto create body (3 1)
                                            push const string "gravityScale"
                                          end set property ret values 0


[66] body.isAwake = true // don't allow body to sleep after dragging

                                          begin set property
                                            const true
                                            get local var auto create body (3 1)
                                            push const string "isAwake"
                                          end set property ret values 0


[67] this.removeEventListener("enterFrame", trackVelocity)

                                          begin call method
                                            push this
                                            begin params 3
                                              push const string "removeEventListener"
                                              ,
                                              push const string "enterFrame"
                                              ,
                                              get local var trackVelocity (8 1)
                                            end params ret values 3
                                          end call method ret values 0
                                        end scope ret values 0
                                      end then
                                    end if ret values 0
                                  end else
                                end if ret values 0
                              end else
                            end if ret values 0
                          end function
                        end params ret values 3
                      end call method ret values 0
                    end function
                  end set by name: [__construct]
                end object
              end extends ret values 1
            end set local var Ball (5 0)


[73] var colors = [ [0.9 0.7 0.7], [0.7 0.9 0.7], [0.7 0.7 0.9] ]

            begin set local var
              begin array 3
                begin set auto index
                  begin array 3
                    begin set auto index
                      push const number 0.9
                    end set auto index
                    ,
                    begin set auto index
                      push const number 0.7
                    end set auto index
                    ,
                    begin set auto index
                      push const number 0.7
                    end set auto index
                  end array
                end set auto index
                ,
                begin set auto index
                  begin array 3
                    begin set auto index
                      push const number 0.7
                    end set auto index
                    ,
                    begin set auto index
                      push const number 0.9
                    end set auto index
                    ,
                    begin set auto index
                      push const number 0.7
                    end set auto index
                  end array
                end set auto index
                ,
                begin set auto index
                  begin array 3
                    begin set auto index
                      push const number 0.7
                    end set auto index
                    ,
                    begin set auto index
                      push const number 0.7
                    end set auto index
                    ,
                    begin set auto index
                      push const number 0.9
                    end set auto index
                  end array
                end set auto index
              end array
            end set local var colors (6 0)


[75] for(var i = 0; i < 3; i++){

            begin scope
              begin locals 1
                7 i
              end locals
              begin set local var
                push const number 0
              end set local var i (7 0)

              begin loop
                begin if
                  begin bool exp
                    begin logic not
                      begin binary operator by local & number
                        begin logic <
                          get local var i (7 0)
                          push const number 3
                        end logic <
                      end binary operator by local & number
                    end logic not
                  end bool exp
                  begin then
                    break
                  end then
                end if ret values 0


[76] var ball = Ball()	// create instance of Ball class

                begin scope
                  begin locals 1
                    8 ball
                  end locals
                  begin set local var
                    begin call
                      get local var Ball (5 0)
                      begin params 0
                      end params ret values 0
                    end call ret values 1
                  end set local var ball (8 0)


[77] ball.x = this.width * math.random(0.2, 0.8)

                  begin set property
                    begin operator *
                      begin get property
                        push this
                        push const string "width"
                      end get property ret values 1
                      begin call method
                        get env var math
                        begin params 3
                          push const string "random"
                          ,
                          push const number 0.2
                          ,
                          push const number 0.8
                        end params ret values 3
                      end call method ret values 1
                    end operator *
                    get local var auto create ball (8 0)
                    push const string "x"
                  end set property ret values 0


[78] ball.y = this.height * math.random(0.2, 0.5)

                  begin set property
                    begin operator *
                      begin get property
                        push this
                        push const string "height"
                      end get property ret values 1
                      begin call method
                        get env var math
                        begin params 3
                          push const string "random"
                          ,
                          push const number 0.2
                          ,
                          push const number 0.5
                        end params ret values 3
                      end call method ret values 1
                    end operator *
                    get local var auto create ball (8 0)
                    push const string "y"
                  end set property ret values 0


[79] ball.color = colors[ i % #colors ]

                  begin set property
                    begin get property
                      get local var colors (6 0)
                      begin operator %
                        get local var i (7 0)
                        begin length
                          get local var colors (6 0)
                        end length
                      end operator %
                    end get property ret values 1
                    get local var auto create ball (8 0)
                    push const string "color"
                  end set property ret values 0


[80] this.insert(ball)	// insert the ball to the scene

                  begin call method
                    push this
                    begin params 2
                      push const string "insert"
                      ,
                      get local var ball (8 0)
                    end params ret values 2
                  end call method ret values 0
                end scope ret values 0


[75] for(var i = 0; i < 3; i++){

                begin code list
                  begin set local var by bin operator local & number
                    begin binary operator by local & number
                      begin operator +
                        get local var i (7 0)
                        push const number 1
                      end operator +
                    end binary operator by local & number
                  end set local var by bin operator local & number i (7 0)
                end code list ret values 0
              end loop ret values 0
            end scope ret values 0


[83] for(var i = 0; i < 2; i++){

            begin scope
              begin locals 1
                9 i
              end locals
              begin set local var
                push const number 0
              end set local var i (9 0)

              begin loop
                begin if
                  begin bool exp
                    begin logic not
                      begin binary operator by local & number
                        begin logic <
                          get local var i (9 0)
                          push const number 2
                        end logic <
                      end binary operator by local & number
                    end logic not
                  end bool exp
                  begin then
                    break
                  end then
                end if ret values 0


[84] var box = Image("box.jpg") // add box

                begin scope
                  begin locals 2
                    10 box
                    11 body
                  end locals
                  begin set local var
                    begin call method
                      get local var _E (0 0)
                      begin params 2
                        push const string "Image"
                        ,
                        push const string "box.jpg"
                      end params ret values 2
                    end call method ret values 1
                  end set local var box (10 0)


[85] box.x = this.width * math.random(0.2, 0.8)

                  begin set property
                    begin operator *
                      begin get property
                        push this
                        push const string "width"
                      end get property ret values 1
                      begin call method
                        get env var math
                        begin params 3
                          push const string "random"
                          ,
                          push const number 0.2
                          ,
                          push const number 0.8
                        end params ret values 3
                      end call method ret values 1
                    end operator *
                    get local var auto create box (10 0)
                    push const string "x"
                  end set property ret values 0


[86] box.y = this.height * math.random(0.2, 0.5)

                  begin set property
                    begin operator *
                      begin get property
                        push this
                        push const string "height"
                      end get property ret values 1
                      begin call method
                        get env var math
                        begin params 3
                          push const string "random"
                          ,
                          push const number 0.2
                          ,
                          push const number 0.5
                        end params ret values 3
                      end call method ret values 1
                    end operator *
                    get local var auto create box (10 0)
                    push const string "y"
                  end set property ret values 0


[87] box.color = colors[ i % #colors ]

                  begin set property
                    begin get property
                      get local var colors (6 0)
                      begin operator %
                        get local var i (9 0)
                        begin length
                          get local var colors (6 0)
                        end length
                      end operator %
                    end get property ret values 1
                    get local var auto create box (10 0)
                    push const string "color"
                  end set property ret values 0


[88] this.insert(box) // insert box to the scene

                  begin call method
                    push this
                    begin params 2
                      push const string "insert"
                      ,
                      get local var box (10 0)
                    end params ret values 2
                  end call method ret values 0


[89] var body = box.addPhysicsBody { // add physics body to the box

                  begin set local var
                    begin call method
                      get local var box (10 0)
                      begin params 2
                        push const string "addPhysicsBody"
                        ,
                        begin object 2

[90] type = "dynamic"

                          begin set by name
                            push const string "dynamic"
                          end set by name: [type]
                          ,

[91] fixture = {

                          begin set by name
                            begin object 2

[92] shape = physics.getBoxShapeVertices([-box.width/2, -box.height/2], [box.width, box.height])

                              begin set by name
                                begin call method
                                  get local var physics (3 1)
                                  begin params 3
                                    push const string "getBoxShapeVertices"
                                    ,
                                    begin array 2
                                      begin set auto index
                                        begin operator /
                                          begin neg
                                            begin get property
                                              get local var box (10 0)
                                              push const string "width"
                                            end get property ret values 1
                                          end neg
                                          push const number 2
                                        end operator /
                                      end set auto index
                                      ,
                                      begin set auto index
                                        begin operator /
                                          begin neg
                                            begin get property
                                              get local var box (10 0)
                                              push const string "height"
                                            end get property ret values 1
                                          end neg
                                          push const number 2
                                        end operator /
                                      end set auto index
                                    end array
                                    ,
                                    begin array 2
                                      begin set auto index
                                        begin get property
                                          get local var box (10 0)
                                          push const string "width"
                                        end get property ret values 1
                                      end set auto index
                                      ,
                                      begin set auto index
                                        begin get property
                                          get local var box (10 0)
                                          push const string "height"
                                        end get property ret values 1
                                      end set auto index
                                    end array
                                  end params ret values 3
                                end call method ret values 1
                              end set by name: [shape]
                              ,

[93] bounce = 0.95

                              begin set by name
                                push const number 0.95
                              end set by name: [bounce]
                            end object
                          end set by name: [fixture]
                        end object
                      end params ret values 2
                    end call method ret values 1
                  end set local var body (11 0)


[97] body.angularVelocity = math.rad(math.random(-720, 720))

                  begin set property
                    begin call method
                      get env var math
                      begin params 2
                        push const string "rad"
                        ,
                        begin call method
                          get env var math
                          begin params 3
                            push const string "random"
                            ,
                            begin neg
                              push const number 720
                            end neg
                            ,
                            push const number 720
                          end params ret values 3
                        end call method ret values 1
                      end params ret values 2
                    end call method ret values 1
                    get local var auto create body (11 0)
                    push const string "angularVelocity"
                  end set property ret values 0


[99] body.linearVelocity = [director.contentWidth * math.random(-1, 1), director.contentWidth * math.random(-1, 1)]

                  begin set property
                    begin array 2
                      begin set auto index
                        begin operator *
                          begin get property
                            get local var director (2 1)
                            push const string "contentWidth"
                          end get property ret values 1
                          begin call method
                            get env var math
                            begin params 3
                              push const string "random"
                              ,
                              begin neg
                                push const number 1
                              end neg
                              ,
                              push const number 1
                            end params ret values 3
                          end call method ret values 1
                        end operator *
                      end set auto index
                      ,
                      begin set auto index
                        begin operator *
                          begin get property
                            get local var director (2 1)
                            push const string "contentWidth"
                          end get property ret values 1
                          begin call method
                            get env var math
                            begin params 3
                              push const string "random"
                              ,
                              begin neg
                                push const number 1
                              end neg
                              ,
                              push const number 1
                            end params ret values 3
                          end call method ret values 1
                        end operator *
                      end set auto index
                    end array
                    get local var auto create body (11 0)
                    push const string "linearVelocity"
                  end set property ret values 0
                end scope ret values 0


[83] for(var i = 0; i < 2; i++){

                begin code list
                  begin set local var by bin operator local & number
                    begin binary operator by local & number
                      begin operator +
                        get local var i (9 0)
                        push const number 1
                      end operator +
                    end binary operator by local & number
                  end set local var by bin operator local & number i (9 0)
                end code list ret values 0
              end loop ret values 0
            end scope ret values 0


[102] var message = Text("Physics Football")	// create message

            begin set local var
              begin call method
                get local var _E (0 0)
                begin params 2
                  push const string "Text"
                  ,
                  push const string "Physics Football"
                end params ret values 2
              end call method ret values 1
            end set local var message (12 0)


[103] message.x = this.width	// locate the message at right bottom corner

            begin set property
              begin get property
                push this
                push const string "width"
              end get property ret values 1
              get local var auto create message (12 0)
              push const string "x"
            end set property ret values 0


[104] message.y = this.height

            begin set property
              begin get property
                push this
                push const string "height"
              end get property ret values 1
              get local var auto create message (12 0)
              push const string "y"
            end set property ret values 0


[105] message.anchor = {x=1.05 y=1.05}

            begin set property
              begin object 2
                begin set by name
                  push const number 1.05
                end set by name: [x]
                ,
                begin set by name
                  push const number 1.05
                end set by name: [y]
              end object
              get local var auto create message (12 0)
              push const string "anchor"
            end set property ret values 0


[106] message.shadow = true	// we want shadow enabled

            begin set property
              const true
              get local var auto create message (12 0)
              push const string "shadow"
            end set property ret values 0


[107] message.zOrder = 1		// use zOrder to put the message at front of balls

            begin set property
              push const number 1
              get local var auto create message (12 0)
              push const string "zOrder"
            end set property ret values 0


[108] this.insert(message)

            begin call method
              push this
              begin params 2
                push const string "insert"
                ,
                get local var message (12 0)
              end params ret values 2
            end call method ret values 0
          end function
        end set by name: [__construct]
      end object
    end extends ret values 1
  end set env var MyScene


[112] director.scene = MyScene()	// create and set our game scene

  begin set property
    begin call method
      get local var _E (0 0)
      begin params 1
        push const string "MyScene"
      end params ret values 1
    end call method ret values 1
    get local var auto create director (2 0)
    push const string "scene"
  end set property ret values 0

  begin code list
    begin return
      get local var _E (0 0)
    end return values 1
  end code list ret values 0
end function
