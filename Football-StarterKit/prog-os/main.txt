
[FILE] raw://../prog-os/main.os
[1] var director = require("director")

begin function
  begin locals, total 3
    0 _E
    1 _G
    2 director
  end locals
  begin set local var
    begin call method
      get local var _E (0 0)
      begin params 2
        push const string "require"
        ,
        push const string "director"
      end params ret values 2
    end call method ret values 1
  end set local var director (2 0)


[3] print "Hello World!" // please see all printed messages here: assets-ram/output.txt

  begin call method
    get local var _E (0 0)
    begin params 2
      push const string "print"
      ,
      push const string "Hello World!"
    end params ret values 2
  end call method ret values 0


[5] MyScene = extends Scene {

  begin set env var
    begin extends
      get env var Scene
      begin object 1

[6] __construct = function(){

        begin set by name
          begin function
            begin locals, total 8
              0 _E
              1 _G
              2 bg
              3 message
              4 Ball
              5 colors
            end locals

[7] super() // call constructor of class we extend

            begin call
              super
              begin params 0
              end params ret values 0
            end call ret values 0


[9] var bg = Image("bg.jpg") 	// create background image

            begin set local var
              begin call method
                get local var _E (0 0)
                begin params 2
                  push const string "Image"
                  ,
                  push const string "bg.jpg"
                end params ret values 2
              end call method ret values 1
            end set local var bg (2 0)


[10] bg.x = this.width / 2		// locate it at center of scene

            begin set property
              begin operator /
                begin get property
                  push this
                  push const string "width"
                end get property ret values 1
                push const number 2
              end operator /
              get local var auto create bg (2 0)
              push const string "x"
            end set property ret values 0


[11] bg.y = this.height / 2

            begin set property
              begin operator /
                begin get property
                  push this
                  push const string "height"
                end get property ret values 1
                push const number 2
              end operator /
              get local var auto create bg (2 0)
              push const string "y"
            end set property ret values 0


[12] bg.scale = math.max(this.width / bg.width, this.height / bg.height)

            begin set property
              begin call method
                get env var math
                begin params 3
                  push const string "max"
                  ,
                  begin operator /
                    begin get property
                      push this
                      push const string "width"
                    end get property ret values 1
                    begin get property
                      get local var bg (2 0)
                      push const string "width"
                    end get property ret values 1
                  end operator /
                  ,
                  begin operator /
                    begin get property
                      push this
                      push const string "height"
                    end get property ret values 1
                    begin get property
                      get local var bg (2 0)
                      push const string "height"
                    end get property ret values 1
                  end operator /
                end params ret values 3
              end call method ret values 1
              get local var auto create bg (2 0)
              push const string "scale"
            end set property ret values 0


[13] this.insert(bg)				// insert the background image to the scene

            begin call method
              push this
              begin params 2
                push const string "insert"
                ,
                get local var bg (2 0)
              end params ret values 2
            end call method ret values 0


[15] var message = Text("Football Starter Kit")	// create message

            begin set local var
              begin call method
                get local var _E (0 0)
                begin params 2
                  push const string "Text"
                  ,
                  push const string "Football Starter Kit"
                end params ret values 2
              end call method ret values 1
            end set local var message (3 0)


[16] message.x = this.width	// locate the message at right bottom corner

            begin set property
              begin get property
                push this
                push const string "width"
              end get property ret values 1
              get local var auto create message (3 0)
              push const string "x"
            end set property ret values 0


[17] message.y = this.height

            begin set property
              begin get property
                push this
                push const string "height"
              end get property ret values 1
              get local var auto create message (3 0)
              push const string "y"
            end set property ret values 0


[18] message.anchor = {x=1.05 y=1.05}

            begin set property
              begin object 2
                begin set by name
                  push const number 1.05
                end set by name: [x]
                ,
                begin set by name
                  push const number 1.05
                end set by name: [y]
              end object
              get local var auto create message (3 0)
              push const string "anchor"
            end set property ret values 0


[19] message.shadow = true	// we want shadow enabled

            begin set property
              const true
              get local var auto create message (3 0)
              push const string "shadow"
            end set property ret values 0


[20] message.zOrder = 1		// use zOrder to put the message at front of balls

            begin set property
              push const number 1
              get local var auto create message (3 0)
              push const string "zOrder"
            end set property ret values 0


[21] this.insert(message)

            begin call method
              push this
              begin params 2
                push const string "insert"
                ,
                get local var message (3 0)
              end params ret values 2
            end call method ret values 0


[24] var Ball = extends Image {

            begin set local var
              begin extends
                get env var Image
                begin object 1

[25] __construct = function(imageFilename){

                  begin set by name
                    begin function
                      begin locals, total 13
                        0 imageFilename (param)
                        1 _E
                        2 _G
                        3 screenWidth
                        4 screen
                        5 speedX
                        6 speedY
                        7 prevX
                        8 prevY
                        9 trackVelocity
                        10 friction
                        11 gravity
                        12 physUpdate
                      end locals

[26] super(imageFilename || "ball.png") // call constructor of Image class

                      begin call
                        super
                        begin params 1
                          begin logic ||
                            get local var imageFilename (0 0 param)
                            push const string "ball.png"
                          end logic ||
                        end params ret values 1
                      end call ret values 0


[29] var screenWidth, screen = director.contentWidth, director.contentHeight

                      begin set local var
                        begin set local var
                          begin params 2
                            begin get property
                              get local var director (2 2)
                              push const string "contentWidth"
                            end get property ret values 1
                            ,
                            begin get property
                              get local var director (2 2)
                              push const string "contentHeight"
                            end get property ret values 1
                          end params ret values 2
                        end set local var screen (4 0)
                      end set local var screenWidth (3 0)


[30] var speedX, speedY = math.random(-0.5, 0.5)*screenWidth, math.random(0.5, 1)*screenWidth

                      begin set local var
                        begin set local var
                          begin params 2
                            begin operator *
                              begin call method
                                get env var math
                                begin params 3
                                  push const string "random"
                                  ,
                                  begin neg
                                    push const number 0.5
                                  end neg
                                  ,
                                  push const number 0.5
                                end params ret values 3
                              end call method ret values 1
                              get local var screenWidth (3 0)
                            end operator *
                            ,
                            begin operator *
                              begin call method
                                get env var math
                                begin params 3
                                  push const string "random"
                                  ,
                                  push const number 0.5
                                  ,
                                  push const number 1
                                end params ret values 3
                              end call method ret values 1
                              get local var screenWidth (3 0)
                            end operator *
                          end params ret values 2
                        end set local var speedY (6 0)
                      end set local var speedX (5 0)


[31] var prevX, prevY = 0, 0

                      begin set local var
                        begin set local var
                          begin params 2
                            push const number 0
                            ,
                            push const number 0
                          end params ret values 2
                        end set local var prevY (8 0)
                      end set local var prevX (7 0)


[32] var function trackVelocity(params){	// track velocity of the ball while dragging

                      begin set local var
                        begin function
                          begin locals, total 3
                            0 params (param)
                            1 _E
                            2 _G
                          end locals

[33] speedX = (this.x - prevX) / params.deltaTime

                          begin set local var
                            begin operator /
                              begin operator -
                                begin get property
                                  push this
                                  push const string "x"
                                end get property ret values 1
                                get local var prevX (7 1)
                              end operator -
                              begin get property
                                get local var params (0 0 param)
                                push const string "deltaTime"
                              end get property ret values 1
                            end operator /
                          end set local var speedX (5 1)


[34] speedY = (this.y - prevY) / params.deltaTime

                          begin set local var
                            begin operator /
                              begin operator -
                                begin get property
                                  push this
                                  push const string "y"
                                end get property ret values 1
                                get local var prevY (8 1)
                              end operator -
                              begin get property
                                get local var params (0 0 param)
                                push const string "deltaTime"
                              end get property ret values 1
                            end operator /
                          end set local var speedY (6 1)


[35] prevX, prevY = this.x, this.y

                          begin set local var
                            begin set local var
                              begin params 2
                                begin get property
                                  push this
                                  push const string "x"
                                end get property ret values 1
                                ,
                                begin get property
                                  push this
                                  push const string "y"
                                end get property ret values 1
                              end params ret values 2
                            end set local var prevY (8 1)
                          end set local var prevX (7 1)
                        end function
                      end set local var trackVelocity (9 0)


[38] var friction, gravity = 0.9, 9

                      begin set local var
                        begin set local var
                          begin params 2
                            push const number 0.9
                            ,
                            push const number 9
                          end params ret values 2
                        end set local var gravity (11 0)
                      end set local var friction (10 0)


[39] var function physUpdate(params){	// main ball physics update function

                      begin set local var
                        begin function
                          begin locals, total 6
                            0 params (param)
                            1 _E
                            2 _G
                            3 parentWidth
                            4 parentHeight
                            5 radius
                          end locals

[40] var parentWidth, parentHeight = this.parent.width, this.parent.height

                          begin set local var
                            begin set local var
                              begin params 2
                                begin get property
                                  begin get property
                                    push this
                                    push const string "parent"
                                  end get property ret values 1
                                  push const string "width"
                                end get property ret values 1
                                ,
                                begin get property
                                  begin get property
                                    push this
                                    push const string "parent"
                                  end get property ret values 1
                                  push const string "height"
                                end get property ret values 1
                              end params ret values 2
                            end set local var parentHeight (4 0)
                          end set local var parentWidth (3 0)


[41] var radius = this.width/2

                          begin set local var
                            begin operator /
                              begin get property
                                push this
                                push const string "width"
                              end get property ret values 1
                              push const number 2
                            end operator /
                          end set local var radius (5 0)


[42] speedY = speedY + gravity

                          begin set local var
                            begin operator +
                              get local var speedY (6 1)
                              get local var gravity (11 1)
                            end operator +
                          end set local var speedY (6 1)


[43] this.x = this.x + speedX * params.deltaTime

                          begin set property
                            begin operator +
                              begin get property
                                push this
                                push const string "x"
                              end get property ret values 1
                              begin operator *
                                get local var speedX (5 1)
                                begin get property
                                  get local var params (0 0 param)
                                  push const string "deltaTime"
                                end get property ret values 1
                              end operator *
                            end operator +
                            push this
                            push const string "x"
                          end set property ret values 0


[44] this.y = this.y + speedY * params.deltaTime

                          begin set property
                            begin operator +
                              begin get property
                                push this
                                push const string "y"
                              end get property ret values 1
                              begin operator *
                                get local var speedY (6 1)
                                begin get property
                                  get local var params (0 0 param)
                                  push const string "deltaTime"
                                end get property ret values 1
                              end operator *
                            end operator +
                            push this
                            push const string "y"
                          end set property ret values 0


[45] if(this.x >= parentWidth - radius){

                          begin if
                            begin bool exp
                              begin logic >=
                                begin get property
                                  push this
                                  push const string "x"
                                end get property ret values 1
                                begin binary operator by locals
                                  begin operator -
                                    get local var parentWidth (3 0)
                                    get local var radius (5 0)
                                  end operator -
                                end binary operator by locals
                              end logic >=
                            end bool exp
                            begin then

[46] this.x = parentWidth - radius

                              begin scope
                                begin set property
                                  begin binary operator by locals
                                    begin operator -
                                      get local var parentWidth (3 0)
                                      get local var radius (5 0)
                                    end operator -
                                  end binary operator by locals
                                  push this
                                  push const string "x"
                                end set property ret values 0


[47] speedX = speedX * -friction	// change dir

                                begin set local var
                                  begin operator *
                                    get local var speedX (5 1)
                                    begin neg
                                      get local var friction (10 1)
                                    end neg
                                  end operator *
                                end set local var speedX (5 1)
                              end scope ret values 0
                            end then
                            begin else

[48] }else if(this.x <= radius){

                              begin if
                                begin bool exp
                                  begin logic <=
                                    begin get property
                                      push this
                                      push const string "x"
                                    end get property ret values 1
                                    get local var radius (5 0)
                                  end logic <=
                                end bool exp
                                begin then

[49] this.x = radius

                                  begin scope
                                    begin set property
                                      get local var radius (5 0)
                                      push this
                                      push const string "x"
                                    end set property ret values 0


[50] speedX = speedX * -friction	// change dir

                                    begin set local var
                                      begin operator *
                                        get local var speedX (5 1)
                                        begin neg
                                          get local var friction (10 1)
                                        end neg
                                      end operator *
                                    end set local var speedX (5 1)
                                  end scope ret values 0
                                end then
                              end if ret values 0
                            end else
                          end if ret values 0


[52] if(this.y >= parentHeight - radius){

                          begin if
                            begin bool exp
                              begin logic >=
                                begin get property
                                  push this
                                  push const string "y"
                                end get property ret values 1
                                begin binary operator by locals
                                  begin operator -
                                    get local var parentHeight (4 0)
                                    get local var radius (5 0)
                                  end operator -
                                end binary operator by locals
                              end logic >=
                            end bool exp
                            begin then

[53] this.y = parentHeight - radius

                              begin scope
                                begin set property
                                  begin binary operator by locals
                                    begin operator -
                                      get local var parentHeight (4 0)
                                      get local var radius (5 0)
                                    end operator -
                                  end binary operator by locals
                                  push this
                                  push const string "y"
                                end set property ret values 0


[54] speedY = speedY * -friction	// change dir

                                begin set local var
                                  begin operator *
                                    get local var speedY (6 1)
                                    begin neg
                                      get local var friction (10 1)
                                    end neg
                                  end operator *
                                end set local var speedY (6 1)


[55] speedX = speedX * friction

                                begin set local var
                                  begin operator *
                                    get local var speedX (5 1)
                                    get local var friction (10 1)
                                  end operator *
                                end set local var speedX (5 1)
                              end scope ret values 0
                            end then
                            begin else

[56] }else if(this.y <= radius){

                              begin if
                                begin bool exp
                                  begin logic <=
                                    begin get property
                                      push this
                                      push const string "y"
                                    end get property ret values 1
                                    get local var radius (5 0)
                                  end logic <=
                                end bool exp
                                begin then

[57] this.y = radius

                                  begin scope
                                    begin set property
                                      get local var radius (5 0)
                                      push this
                                      push const string "y"
                                    end set property ret values 0


[58] speedY = speedY * -friction	// change dir

                                    begin set local var
                                      begin operator *
                                        get local var speedY (6 1)
                                        begin neg
                                          get local var friction (10 1)
                                        end neg
                                      end operator *
                                    end set local var speedY (6 1)
                                  end scope ret values 0
                                end then
                              end if ret values 0
                            end else
                          end if ret values 0
                        end function
                      end set local var physUpdate (12 0)


[61] this.addEventListener("enterFrame", physUpdate)	// add physUpdate as enterFrame listener

                      begin call method
                        push this
                        begin params 3
                          push const string "addEventListener"
                          ,
                          push const string "enterFrame"
                          ,
                          get local var physUpdate (12 0)
                        end params ret values 3
                      end call method ret values 0


[63] this.addEventListener("touch", function(touch){	// add touch behavior

                      begin call method
                        push this
                        begin params 3
                          push const string "addEventListener"
                          ,
                          push const string "touch"
                          ,
                          begin function
                            begin locals, total 3
                              0 touch (param)
                              1 _E
                              2 _G
                            end locals

[64] if(touch.phase == "start"){

                            begin if
                              begin bool exp
                                begin logic ==
                                  begin get property
                                    get local var touch (0 0 param)
                                    push const string "phase"
                                  end get property ret values 1
                                  push const string "start"
                                end logic ==
                              end bool exp
                              begin then

[65] this.x0, this.y0 = touch.x - this.x, touch.y - this.y

                                begin scope
                                  begin set property
                                    begin set property
                                      begin params 2
                                        begin operator -
                                          begin get property
                                            get local var touch (0 0 param)
                                            push const string "x"
                                          end get property ret values 1
                                          begin get property
                                            push this
                                            push const string "x"
                                          end get property ret values 1
                                        end operator -
                                        ,
                                        begin operator -
                                          begin get property
                                            get local var touch (0 0 param)
                                            push const string "y"
                                          end get property ret values 1
                                          begin get property
                                            push this
                                            push const string "y"
                                          end get property ret values 1
                                        end operator -
                                      end params ret values 2
                                      push this
                                      push const string "y0"
                                    end set property ret values 1
                                    push this
                                    push const string "x0"
                                  end set property ret values 0


[66] this.removeEventListener("enterFrame", physUpdate)

                                  begin call method
                                    push this
                                    begin params 3
                                      push const string "removeEventListener"
                                      ,
                                      push const string "enterFrame"
                                      ,
                                      get local var physUpdate (12 1)
                                    end params ret values 3
                                  end call method ret values 0


[67] this.addEventListener("enterFrame", trackVelocity)

                                  begin call method
                                    push this
                                    begin params 3
                                      push const string "addEventListener"
                                      ,
                                      push const string "enterFrame"
                                      ,
                                      get local var trackVelocity (9 1)
                                    end params ret values 3
                                  end call method ret values 0
                                end scope ret values 0
                              end then
                              begin else

[68] }else if(touch.phase == "move"){

                                begin if
                                  begin bool exp
                                    begin logic ==
                                      begin get property
                                        get local var touch (0 0 param)
                                        push const string "phase"
                                      end get property ret values 1
                                      push const string "move"
                                    end logic ==
                                  end bool exp
                                  begin then

[69] this.x, this.y = touch.x - this.x0, touch.y - this.y0

                                    begin scope
                                      begin set property
                                        begin set property
                                          begin params 2
                                            begin operator -
                                              begin get property
                                                get local var touch (0 0 param)
                                                push const string "x"
                                              end get property ret values 1
                                              begin get property
                                                push this
                                                push const string "x0"
                                              end get property ret values 1
                                            end operator -
                                            ,
                                            begin operator -
                                              begin get property
                                                get local var touch (0 0 param)
                                                push const string "y"
                                              end get property ret values 1
                                              begin get property
                                                push this
                                                push const string "y0"
                                              end get property ret values 1
                                            end operator -
                                          end params ret values 2
                                          push this
                                          push const string "y"
                                        end set property ret values 1
                                        push this
                                        push const string "x"
                                      end set property ret values 0
                                    end scope ret values 0
                                  end then
                                  begin else

[70] }else if(touch.phase == "end" || touch.phase == "cancel"){

                                    begin if
                                      begin bool exp
                                        begin logic ||
                                          begin logic ==
                                            begin get property
                                              get local var touch (0 0 param)
                                              push const string "phase"
                                            end get property ret values 1
                                            push const string "end"
                                          end logic ==
                                          begin logic ==
                                            begin get property
                                              get local var touch (0 0 param)
                                              push const string "phase"
                                            end get property ret values 1
                                            push const string "cancel"
                                          end logic ==
                                        end logic ||
                                      end bool exp
                                      begin then

[71] this.addEventListener("enterFrame", physUpdate)

                                        begin scope
                                          begin call method
                                            push this
                                            begin params 3
                                              push const string "addEventListener"
                                              ,
                                              push const string "enterFrame"
                                              ,
                                              get local var physUpdate (12 1)
                                            end params ret values 3
                                          end call method ret values 0


[72] this.removeEventListener("enterFrame", trackVelocity)

                                          begin call method
                                            push this
                                            begin params 3
                                              push const string "removeEventListener"
                                              ,
                                              push const string "enterFrame"
                                              ,
                                              get local var trackVelocity (9 1)
                                            end params ret values 3
                                          end call method ret values 0
                                        end scope ret values 0
                                      end then
                                    end if ret values 0
                                  end else
                                end if ret values 0
                              end else
                            end if ret values 0
                          end function
                        end params ret values 3
                      end call method ret values 0
                    end function
                  end set by name: [__construct]
                end object
              end extends ret values 1
            end set local var Ball (4 0)


[78] var colors = [ [0.9 0.7 0.7], [0.7 0.9 0.7], [0.7 0.7 0.9] ]

            begin set local var
              begin array 3
                begin set auto index
                  begin array 3
                    begin set auto index
                      push const number 0.9
                    end set auto index
                    ,
                    begin set auto index
                      push const number 0.7
                    end set auto index
                    ,
                    begin set auto index
                      push const number 0.7
                    end set auto index
                  end array
                end set auto index
                ,
                begin set auto index
                  begin array 3
                    begin set auto index
                      push const number 0.7
                    end set auto index
                    ,
                    begin set auto index
                      push const number 0.9
                    end set auto index
                    ,
                    begin set auto index
                      push const number 0.7
                    end set auto index
                  end array
                end set auto index
                ,
                begin set auto index
                  begin array 3
                    begin set auto index
                      push const number 0.7
                    end set auto index
                    ,
                    begin set auto index
                      push const number 0.7
                    end set auto index
                    ,
                    begin set auto index
                      push const number 0.9
                    end set auto index
                  end array
                end set auto index
              end array
            end set local var colors (5 0)


[80] for(var i = 0; i < 3; i++){

            begin scope
              begin locals 1
                6 i
              end locals
              begin set local var
                push const number 0
              end set local var i (6 0)

              begin loop
                begin if
                  begin bool exp
                    begin logic not
                      begin binary operator by local & number
                        begin logic <
                          get local var i (6 0)
                          push const number 3
                        end logic <
                      end binary operator by local & number
                    end logic not
                  end bool exp
                  begin then
                    break
                  end then
                end if ret values 0


[81] var ball = Ball()	// create instance of Ball class

                begin scope
                  begin locals 1
                    7 ball
                  end locals
                  begin set local var
                    begin call
                      get local var Ball (4 0)
                      begin params 0
                      end params ret values 0
                    end call ret values 1
                  end set local var ball (7 0)


[82] ball.x = this.width * math.random(0.3, 0.7)

                  begin set property
                    begin operator *
                      begin get property
                        push this
                        push const string "width"
                      end get property ret values 1
                      begin call method
                        get env var math
                        begin params 3
                          push const string "random"
                          ,
                          push const number 0.3
                          ,
                          push const number 0.7
                        end params ret values 3
                      end call method ret values 1
                    end operator *
                    get local var auto create ball (7 0)
                    push const string "x"
                  end set property ret values 0


[83] ball.y = this.height * math.random(0.3, 0.5)

                  begin set property
                    begin operator *
                      begin get property
                        push this
                        push const string "height"
                      end get property ret values 1
                      begin call method
                        get env var math
                        begin params 3
                          push const string "random"
                          ,
                          push const number 0.3
                          ,
                          push const number 0.5
                        end params ret values 3
                      end call method ret values 1
                    end operator *
                    get local var auto create ball (7 0)
                    push const string "y"
                  end set property ret values 0


[84] ball.color = colors[ i % #colors ]

                  begin set property
                    begin get property
                      get local var colors (5 0)
                      begin operator %
                        get local var i (6 0)
                        begin length
                          get local var colors (5 0)
                        end length
                      end operator %
                    end get property ret values 1
                    get local var auto create ball (7 0)
                    push const string "color"
                  end set property ret values 0


[85] this.insert(ball)	// insert the ball to the scene

                  begin call method
                    push this
                    begin params 2
                      push const string "insert"
                      ,
                      get local var ball (7 0)
                    end params ret values 2
                  end call method ret values 0
                end scope ret values 0


[80] for(var i = 0; i < 3; i++){

                begin code list
                  begin set local var by bin operator local & number
                    begin binary operator by local & number
                      begin operator +
                        get local var i (6 0)
                        push const number 1
                      end operator +
                    end binary operator by local & number
                  end set local var by bin operator local & number i (6 0)
                end code list ret values 0
              end loop ret values 0
            end scope ret values 0
          end function
        end set by name: [__construct]
      end object
    end extends ret values 1
  end set env var MyScene


[90] director.scene = MyScene()	// create and set our game scene

  begin set property
    begin call method
      get local var _E (0 0)
      begin params 1
        push const string "MyScene"
      end params ret values 1
    end call method ret values 1
    get local var auto create director (2 0)
    push const string "scene"
  end set property ret values 0

  begin code list
    begin return
      get local var _E (0 0)
    end return values 1
  end code list ret values 0
end function
