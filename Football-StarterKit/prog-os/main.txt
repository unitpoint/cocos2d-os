
[FILE] raw://../prog-os/main.os
[1] var core = require("core")

begin function
  begin locals, total 7
    0 _E
    1 _G
    2 core
    3 app
    4 node
    5 image
    6 director
  end locals
  begin set local var
    begin call method
      get local var _E (0 0)
      begin params 2
        push const string "require"
        ,
        push const string "core"
      end params ret values 2
    end call method ret values 1
  end set local var core (2 0)


[2] var app = require("app")

  begin set local var
    begin call method
      get local var _E (0 0)
      begin params 2
        push const string "require"
        ,
        push const string "app"
      end params ret values 2
    end call method ret values 1
  end set local var app (3 0)


[3] var node = require("node")

  begin set local var
    begin call method
      get local var _E (0 0)
      begin params 2
        push const string "require"
        ,
        push const string "node"
      end params ret values 2
    end call method ret values 1
  end set local var node (4 0)


[4] var image = require("image")

  begin set local var
    begin call method
      get local var _E (0 0)
      begin params 2
        push const string "require"
        ,
        push const string "image"
      end params ret values 2
    end call method ret values 1
  end set local var image (5 0)


[5] var director = require("director")

  begin set local var
    begin call method
      get local var _E (0 0)
      begin params 2
        push const string "require"
        ,
        push const string "director"
      end params ret values 2
    end call method ret values 1
  end set local var director (6 0)


[7] print "Hello World!"

  begin call method
    get local var _E (0 0)
    begin params 2
      push const string "print"
      ,
      push const string "Hello World!"
    end params ret values 2
  end call method ret values 0


[9] MyScene = extends Scene {

  begin set env var
    begin extends
      get env var Scene
      begin object 1

[10] __construct = function(){

        begin set by name
          begin function
            begin locals, total 7
              0 _E
              1 _G
              2 bg
              3 Ball
              4 colors
            end locals

[11] super()

            begin call
              super
              begin params 0
              end params ret values 0
            end call ret values 0


[13] var bg = Image("bg.jpg")

            begin set local var
              begin call method
                get local var _E (0 0)
                begin params 2
                  push const string "Image"
                  ,
                  push const string "bg.jpg"
                end params ret values 2
              end call method ret values 1
            end set local var bg (2 0)


[14] bg.x = this.width / 2

            begin set property
              begin operator /
                begin get property
                  push this
                  push const string "width"
                end get property ret values 1
                push const number 2
              end operator /
              get local var auto create bg (2 0)
              push const string "x"
            end set property ret values 0


[15] bg.y = this.height / 2

            begin set property
              begin operator /
                begin get property
                  push this
                  push const string "height"
                end get property ret values 1
                push const number 2
              end operator /
              get local var auto create bg (2 0)
              push const string "y"
            end set property ret values 0


[16] bg.scale = math.max(this.width / bg.width, this.height / bg.height)

            begin set property
              begin call method
                get env var math
                begin params 3
                  push const string "max"
                  ,
                  begin operator /
                    begin get property
                      push this
                      push const string "width"
                    end get property ret values 1
                    begin get property
                      get local var bg (2 0)
                      push const string "width"
                    end get property ret values 1
                  end operator /
                  ,
                  begin operator /
                    begin get property
                      push this
                      push const string "height"
                    end get property ret values 1
                    begin get property
                      get local var bg (2 0)
                      push const string "height"
                    end get property ret values 1
                  end operator /
                end params ret values 3
              end call method ret values 1
              get local var auto create bg (2 0)
              push const string "scale"
            end set property ret values 0


[17] this.insert(bg)

            begin call method
              push this
              begin params 2
                push const string "insert"
                ,
                get local var bg (2 0)
              end params ret values 2
            end call method ret values 0


[19] var Ball = extends Image {

            begin set local var
              begin extends
                get env var Image
                begin object 1

[20] __construct = function(imageFilename){

                  begin set by name
                    begin function
                      begin locals, total 15
                        0 imageFilename (param)
                        1 _E
                        2 _G
                        3 screenWidth
                        4 screen
                        5 speedX
                        6 speedY
                        7 x0
                        8 y0
                        9 prevX
                        10 prevY
                        11 trackVelocity
                        12 friction
                        13 gravity
                        14 physUpdate
                      end locals

[21] super(imageFilename || "ball.png")

                      begin call
                        super
                        begin params 1
                          begin logic ||
                            get local var imageFilename (0 0 param)
                            push const string "ball.png"
                          end logic ||
                        end params ret values 1
                      end call ret values 0


[23] var screenWidth, screen = director.width, director.height

                      begin set local var
                        begin set local var
                          begin params 2
                            begin get property
                              get local var director (6 2)
                              push const string "width"
                            end get property ret values 1
                            ,
                            begin get property
                              get local var director (6 2)
                              push const string "height"
                            end get property ret values 1
                          end params ret values 2
                        end set local var screen (4 0)
                      end set local var screenWidth (3 0)


[24] var speedX, speedY = math.random(-0.5, 0.5)*screenWidth, math.random(0.5, 1)*screenWidth

                      begin set local var
                        begin set local var
                          begin params 2
                            begin operator *
                              begin call method
                                get env var math
                                begin params 3
                                  push const string "random"
                                  ,
                                  begin neg
                                    push const number 0.5
                                  end neg
                                  ,
                                  push const number 0.5
                                end params ret values 3
                              end call method ret values 1
                              get local var screenWidth (3 0)
                            end operator *
                            ,
                            begin operator *
                              begin call method
                                get env var math
                                begin params 3
                                  push const string "random"
                                  ,
                                  push const number 0.5
                                  ,
                                  push const number 1
                                end params ret values 3
                              end call method ret values 1
                              get local var screenWidth (3 0)
                            end operator *
                          end params ret values 2
                        end set local var speedY (6 0)
                      end set local var speedX (5 0)


[26] var x0, y0

                      begin params 2
                        new local var x0 (7 0)
                        ,
                        new local var y0 (8 0)
                      end params ret values 0


[27] this.addEventListener("touch", function(touch){

                      begin call method
                        push this
                        begin params 3
                          push const string "addEventListener"
                          ,
                          push const string "touch"
                          ,
                          begin function
                            begin locals, total 3
                              0 touch (param)
                              1 _E
                              2 _G
                            end locals

[28] if(touch.phase == "start"){

                            begin if
                              begin bool exp
                                begin logic ==
                                  begin get property
                                    get local var touch (0 0 param)
                                    push const string "phase"
                                  end get property ret values 1
                                  push const string "start"
                                end logic ==
                              end bool exp
                              begin then

[29] x0, y0 = touch.x - this.x, touch.y - this.y

                                begin scope
                                  begin set local var
                                    begin set local var
                                      begin params 2
                                        begin operator -
                                          begin get property
                                            get local var touch (0 0 param)
                                            push const string "x"
                                          end get property ret values 1
                                          begin get property
                                            push this
                                            push const string "x"
                                          end get property ret values 1
                                        end operator -
                                        ,
                                        begin operator -
                                          begin get property
                                            get local var touch (0 0 param)
                                            push const string "y"
                                          end get property ret values 1
                                          begin get property
                                            push this
                                            push const string "y"
                                          end get property ret values 1
                                        end operator -
                                      end params ret values 2
                                    end set local var y0 (8 1)
                                  end set local var x0 (7 1)


[30] this.removeEventListener("enterFrame", physUpdate)

                                  begin call method
                                    push this
                                    begin params 3
                                      push const string "removeEventListener"
                                      ,
                                      push const string "enterFrame"
                                      ,
                                      get local var physUpdate (14 1)
                                    end params ret values 3
                                  end call method ret values 0


[31] this.addEventListener("enterFrame", trackVelocity)

                                  begin call method
                                    push this
                                    begin params 3
                                      push const string "addEventListener"
                                      ,
                                      push const string "enterFrame"
                                      ,
                                      get local var trackVelocity (11 1)
                                    end params ret values 3
                                  end call method ret values 0
                                end scope ret values 0
                              end then
                              begin else

[32] }else if(touch.phase == "move"){

                                begin if
                                  begin bool exp
                                    begin logic ==
                                      begin get property
                                        get local var touch (0 0 param)
                                        push const string "phase"
                                      end get property ret values 1
                                      push const string "move"
                                    end logic ==
                                  end bool exp
                                  begin then

[33] this.x, this.y = touch.x - x0, touch.y - y0

                                    begin scope
                                      begin set property
                                        begin set property
                                          begin params 2
                                            begin operator -
                                              begin get property
                                                get local var touch (0 0 param)
                                                push const string "x"
                                              end get property ret values 1
                                              get local var x0 (7 1)
                                            end operator -
                                            ,
                                            begin operator -
                                              begin get property
                                                get local var touch (0 0 param)
                                                push const string "y"
                                              end get property ret values 1
                                              get local var y0 (8 1)
                                            end operator -
                                          end params ret values 2
                                          push this
                                          push const string "y"
                                        end set property ret values 1
                                        push this
                                        push const string "x"
                                      end set property ret values 0
                                    end scope ret values 0
                                  end then
                                  begin else

[34] }else if(touch.phase == "end" || touch.phase == "cancel"){

                                    begin if
                                      begin bool exp
                                        begin logic ||
                                          begin logic ==
                                            begin get property
                                              get local var touch (0 0 param)
                                              push const string "phase"
                                            end get property ret values 1
                                            push const string "end"
                                          end logic ==
                                          begin logic ==
                                            begin get property
                                              get local var touch (0 0 param)
                                              push const string "phase"
                                            end get property ret values 1
                                            push const string "cancel"
                                          end logic ==
                                        end logic ||
                                      end bool exp
                                      begin then

[35] this.addEventListener("enterFrame", physUpdate)

                                        begin scope
                                          begin call method
                                            push this
                                            begin params 3
                                              push const string "addEventListener"
                                              ,
                                              push const string "enterFrame"
                                              ,
                                              get local var physUpdate (14 1)
                                            end params ret values 3
                                          end call method ret values 0


[36] this.removeEventListener("enterFrame", trackVelocity)

                                          begin call method
                                            push this
                                            begin params 3
                                              push const string "removeEventListener"
                                              ,
                                              push const string "enterFrame"
                                              ,
                                              get local var trackVelocity (11 1)
                                            end params ret values 3
                                          end call method ret values 0
                                        end scope ret values 0
                                      end then
                                    end if ret values 0
                                  end else
                                end if ret values 0
                              end else
                            end if ret values 0
                          end function
                        end params ret values 3
                      end call method ret values 0


[40] var prevX, prevY = 0, 0

                      begin set local var
                        begin set local var
                          begin params 2
                            push const number 0
                            ,
                            push const number 0
                          end params ret values 2
                        end set local var prevY (10 0)
                      end set local var prevX (9 0)


[41] var function trackVelocity(params){

                      begin set local var
                        begin function
                          begin locals, total 3
                            0 params (param)
                            1 _E
                            2 _G
                          end locals

[42] speedX = (this.x - prevX) / params.deltaTime

                          begin set local var
                            begin operator /
                              begin operator -
                                begin get property
                                  push this
                                  push const string "x"
                                end get property ret values 1
                                get local var prevX (9 1)
                              end operator -
                              begin get property
                                get local var params (0 0 param)
                                push const string "deltaTime"
                              end get property ret values 1
                            end operator /
                          end set local var speedX (5 1)


[43] speedY = (this.y - prevY) / params.deltaTime

                          begin set local var
                            begin operator /
                              begin operator -
                                begin get property
                                  push this
                                  push const string "y"
                                end get property ret values 1
                                get local var prevY (10 1)
                              end operator -
                              begin get property
                                get local var params (0 0 param)
                                push const string "deltaTime"
                              end get property ret values 1
                            end operator /
                          end set local var speedY (6 1)


[44] prevX, prevY = this.x, this.y

                          begin set local var
                            begin set local var
                              begin params 2
                                begin get property
                                  push this
                                  push const string "x"
                                end get property ret values 1
                                ,
                                begin get property
                                  push this
                                  push const string "y"
                                end get property ret values 1
                              end params ret values 2
                            end set local var prevY (10 1)
                          end set local var prevX (9 1)
                        end function
                      end set local var trackVelocity (11 0)


[47] var friction, gravity = 0.9, 9

                      begin set local var
                        begin set local var
                          begin params 2
                            push const number 0.9
                            ,
                            push const number 9
                          end params ret values 2
                        end set local var gravity (13 0)
                      end set local var friction (12 0)


[48] var function physUpdate(params){

                      begin set local var
                        begin function
                          begin locals, total 6
                            0 params (param)
                            1 _E
                            2 _G
                            3 parentWidth
                            4 parentHeight
                            5 radius
                          end locals

[49] var parentWidth, parentHeight = this.parent.width, this.parent.height

                          begin set local var
                            begin set local var
                              begin params 2
                                begin get property
                                  begin get property
                                    push this
                                    push const string "parent"
                                  end get property ret values 1
                                  push const string "width"
                                end get property ret values 1
                                ,
                                begin get property
                                  begin get property
                                    push this
                                    push const string "parent"
                                  end get property ret values 1
                                  push const string "height"
                                end get property ret values 1
                              end params ret values 2
                            end set local var parentHeight (4 0)
                          end set local var parentWidth (3 0)


[50] var radius = this.width/2

                          begin set local var
                            begin operator /
                              begin get property
                                push this
                                push const string "width"
                              end get property ret values 1
                              push const number 2
                            end operator /
                          end set local var radius (5 0)


[51] speedY = speedY + gravity

                          begin set local var
                            begin operator +
                              get local var speedY (6 1)
                              get local var gravity (13 1)
                            end operator +
                          end set local var speedY (6 1)


[52] this.x = this.x + speedX * params.deltaTime

                          begin set property
                            begin operator +
                              begin get property
                                push this
                                push const string "x"
                              end get property ret values 1
                              begin operator *
                                get local var speedX (5 1)
                                begin get property
                                  get local var params (0 0 param)
                                  push const string "deltaTime"
                                end get property ret values 1
                              end operator *
                            end operator +
                            push this
                            push const string "x"
                          end set property ret values 0


[53] this.y = this.y + speedY * params.deltaTime

                          begin set property
                            begin operator +
                              begin get property
                                push this
                                push const string "y"
                              end get property ret values 1
                              begin operator *
                                get local var speedY (6 1)
                                begin get property
                                  get local var params (0 0 param)
                                  push const string "deltaTime"
                                end get property ret values 1
                              end operator *
                            end operator +
                            push this
                            push const string "y"
                          end set property ret values 0


[54] if(this.x >= parentWidth - radius){

                          begin if
                            begin bool exp
                              begin logic >=
                                begin get property
                                  push this
                                  push const string "x"
                                end get property ret values 1
                                begin operator -
                                  get local var parentWidth (3 0)
                                  get local var radius (5 0)
                                end operator -
                              end logic >=
                            end bool exp
                            begin then

[55] this.x = parentWidth - radius

                              begin scope
                                begin set property
                                  begin operator -
                                    get local var parentWidth (3 0)
                                    get local var radius (5 0)
                                  end operator -
                                  push this
                                  push const string "x"
                                end set property ret values 0


[56] speedX = speedX * -friction

                                begin set local var
                                  begin operator *
                                    get local var speedX (5 1)
                                    begin neg
                                      get local var friction (12 1)
                                    end neg
                                  end operator *
                                end set local var speedX (5 1)
                              end scope ret values 0
                            end then
                            begin else

[57] }else if(this.x <= radius){

                              begin if
                                begin bool exp
                                  begin logic <=
                                    begin get property
                                      push this
                                      push const string "x"
                                    end get property ret values 1
                                    get local var radius (5 0)
                                  end logic <=
                                end bool exp
                                begin then

[58] this.x = radius

                                  begin scope
                                    begin set property
                                      get local var radius (5 0)
                                      push this
                                      push const string "x"
                                    end set property ret values 0


[59] speedX = speedX * -friction

                                    begin set local var
                                      begin operator *
                                        get local var speedX (5 1)
                                        begin neg
                                          get local var friction (12 1)
                                        end neg
                                      end operator *
                                    end set local var speedX (5 1)
                                  end scope ret values 0
                                end then
                              end if ret values 0
                            end else
                          end if ret values 0


[61] if(this.y >= parentHeight - radius){

                          begin if
                            begin bool exp
                              begin logic >=
                                begin get property
                                  push this
                                  push const string "y"
                                end get property ret values 1
                                begin operator -
                                  get local var parentHeight (4 0)
                                  get local var radius (5 0)
                                end operator -
                              end logic >=
                            end bool exp
                            begin then

[62] this.y = parentHeight - radius

                              begin scope
                                begin set property
                                  begin operator -
                                    get local var parentHeight (4 0)
                                    get local var radius (5 0)
                                  end operator -
                                  push this
                                  push const string "y"
                                end set property ret values 0


[63] speedY = speedY * -friction

                                begin set local var
                                  begin operator *
                                    get local var speedY (6 1)
                                    begin neg
                                      get local var friction (12 1)
                                    end neg
                                  end operator *
                                end set local var speedY (6 1)


[64] speedX = speedX * friction

                                begin set local var
                                  begin operator *
                                    get local var speedX (5 1)
                                    get local var friction (12 1)
                                  end operator *
                                end set local var speedX (5 1)
                              end scope ret values 0
                            end then
                            begin else

[65] }else if(this.y <= radius){

                              begin if
                                begin bool exp
                                  begin logic <=
                                    begin get property
                                      push this
                                      push const string "y"
                                    end get property ret values 1
                                    get local var radius (5 0)
                                  end logic <=
                                end bool exp
                                begin then

[66] this.y = radius

                                  begin scope
                                    begin set property
                                      get local var radius (5 0)
                                      push this
                                      push const string "y"
                                    end set property ret values 0


[67] speedY = speedY * -friction

                                    begin set local var
                                      begin operator *
                                        get local var speedY (6 1)
                                        begin neg
                                          get local var friction (12 1)
                                        end neg
                                      end operator *
                                    end set local var speedY (6 1)
                                  end scope ret values 0
                                end then
                              end if ret values 0
                            end else
                          end if ret values 0
                        end function
                      end set local var physUpdate (14 0)


[70] this.addEventListener("enterFrame", physUpdate)

                      begin call method
                        push this
                        begin params 3
                          push const string "addEventListener"
                          ,
                          push const string "enterFrame"
                          ,
                          get local var physUpdate (14 0)
                        end params ret values 3
                      end call method ret values 0
                    end function
                  end set by name: [__construct]
                end object
              end extends ret values 1
            end set local var Ball (3 0)


[74] var colors = [ [0.9 0.7 0.7], [0.7 0.9 0.7], [0.7 0.7 0.9] ]

            begin set local var
              begin array 3
                begin set auto index
                  begin array 3
                    begin set auto index
                      push const number 0.9
                    end set auto index
                    ,
                    begin set auto index
                      push const number 0.7
                    end set auto index
                    ,
                    begin set auto index
                      push const number 0.7
                    end set auto index
                  end array
                end set auto index
                ,
                begin set auto index
                  begin array 3
                    begin set auto index
                      push const number 0.7
                    end set auto index
                    ,
                    begin set auto index
                      push const number 0.9
                    end set auto index
                    ,
                    begin set auto index
                      push const number 0.7
                    end set auto index
                  end array
                end set auto index
                ,
                begin set auto index
                  begin array 3
                    begin set auto index
                      push const number 0.7
                    end set auto index
                    ,
                    begin set auto index
                      push const number 0.7
                    end set auto index
                    ,
                    begin set auto index
                      push const number 0.9
                    end set auto index
                  end array
                end set auto index
              end array
            end set local var colors (4 0)


[75] for(var i = 0; i < 3; i++){

            begin scope
              begin locals 1
                5 i
              end locals
              begin set local var
                push const number 0
              end set local var i (5 0)

              begin loop
                begin if
                  begin bool exp
                    begin logic not
                      begin logic <
                        get local var i (5 0)
                        push const number 3
                      end logic <
                    end logic not
                  end bool exp
                  begin then
                    break
                  end then
                end if ret values 0


[76] var ball = Ball()

                begin scope
                  begin locals 1
                    6 ball
                  end locals
                  begin set local var
                    begin call
                      get local var Ball (3 0)
                      begin params 0
                      end params ret values 0
                    end call ret values 1
                  end set local var ball (6 0)


[77] ball.x = this.width * math.random(0.3, 0.7)

                  begin set property
                    begin operator *
                      begin get property
                        push this
                        push const string "width"
                      end get property ret values 1
                      begin call method
                        get env var math
                        begin params 3
                          push const string "random"
                          ,
                          push const number 0.3
                          ,
                          push const number 0.7
                        end params ret values 3
                      end call method ret values 1
                    end operator *
                    get local var auto create ball (6 0)
                    push const string "x"
                  end set property ret values 0


[78] ball.y = this.height * math.random(0.3, 0.5)

                  begin set property
                    begin operator *
                      begin get property
                        push this
                        push const string "height"
                      end get property ret values 1
                      begin call method
                        get env var math
                        begin params 3
                          push const string "random"
                          ,
                          push const number 0.3
                          ,
                          push const number 0.5
                        end params ret values 3
                      end call method ret values 1
                    end operator *
                    get local var auto create ball (6 0)
                    push const string "y"
                  end set property ret values 0


[79] ball.color = colors[ i % #colors ]

                  begin set property
                    begin get property
                      get local var colors (4 0)
                      begin operator %
                        get local var i (5 0)
                        begin length
                          get local var colors (4 0)
                        end length
                      end operator %
                    end get property ret values 1
                    get local var auto create ball (6 0)
                    push const string "color"
                  end set property ret values 0


[80] this.insert(ball)

                  begin call method
                    push this
                    begin params 2
                      push const string "insert"
                      ,
                      get local var ball (6 0)
                    end params ret values 2
                  end call method ret values 0
                end scope ret values 0


[75] for(var i = 0; i < 3; i++){

                begin code list
                  begin set local var
                    begin operator +
                      get local var i (5 0)
                      push const number 1
                    end operator +
                  end set local var i (5 0)
                end code list ret values 0
              end loop ret values 0
            end scope ret values 0
          end function
        end set by name: [__construct]
      end object
    end extends ret values 1
  end set env var MyScene


[85] director.scene = MyScene()

  begin set property
    begin call method
      get local var _E (0 0)
      begin params 1
        push const string "MyScene"
      end params ret values 1
    end call method ret values 1
    get local var auto create director (6 0)
    push const string "scene"
  end set property ret values 0

  begin code list
    begin return
      get local var _E (0 0)
    end return values 1
  end code list ret values 0
end function
