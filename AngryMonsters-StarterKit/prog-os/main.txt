
[FILE] raw://../prog-os/main.os
[1] var director = require("director")

begin function
  begin locals, total 3
    0 _E
    1 _G
    2 director
  end locals
  begin set local var
    begin call method
      get local var _E (0 0)
      begin params 2
        push const string "require"
        ,
        push const string "director"
      end params ret values 2
    end call method ret values 1
  end set local var director (2 0)


[3] print "Hello World!" // please see all printed messages here: assets-ram/output.txt

  begin call method
    get local var _E (0 0)
    begin params 2
      push const string "print"
      ,
      push const string "Hello World!"
    end params ret values 2
  end call method ret values 0


[5] MyScene = extends Scene {

  begin set env var
    begin extends
      get env var Scene
      begin object 1

[6] __construct = function(){

        begin set by name
          begin function
            begin locals, total 22
              0 _E
              1 _G
              2 bg
              3 message
              4 animations
              14 Monster
              15 color
              16 monsters
              17 scene
              18 monsterNames
              19 createMonster
              21 moveMonsters
            end locals

[7] super() // call constructor of class we extend

            begin call
              super
              begin params 0
              end params ret values 0
            end call ret values 0


[9] var bg = Image("bg.jpg") 	// create background image

            begin set local var
              begin call method
                get local var _E (0 0)
                begin params 2
                  push const string "Image"
                  ,
                  push const string "bg.jpg"
                end params ret values 2
              end call method ret values 1
            end set local var bg (2 0)


[10] bg.x = this.width / 2		// locate it at center of scene

            begin set property
              begin operator /
                begin get property
                  push this
                  push const string "width"
                end get property ret values 1
                push const number 2
              end operator /
              get local var auto create bg (2 0)
              push const string "x"
            end set property ret values 0


[11] bg.y = this.height / 2

            begin set property
              begin operator /
                begin get property
                  push this
                  push const string "height"
                end get property ret values 1
                push const number 2
              end operator /
              get local var auto create bg (2 0)
              push const string "y"
            end set property ret values 0


[12] bg.scale = math.max(this.width / bg.width, this.height / bg.height)

            begin set property
              begin call method
                get env var math
                begin params 3
                  push const string "max"
                  ,
                  begin operator /
                    begin get property
                      push this
                      push const string "width"
                    end get property ret values 1
                    begin get property
                      get local var bg (2 0)
                      push const string "width"
                    end get property ret values 1
                  end operator /
                  ,
                  begin operator /
                    begin get property
                      push this
                      push const string "height"
                    end get property ret values 1
                    begin get property
                      get local var bg (2 0)
                      push const string "height"
                    end get property ret values 1
                  end operator /
                end params ret values 3
              end call method ret values 1
              get local var auto create bg (2 0)
              push const string "scale"
            end set property ret values 0


[13] this.insert(bg)				// insert the background image to the scene

            begin call method
              push this
              begin params 2
                push const string "insert"
                ,
                get local var bg (2 0)
              end params ret values 2
            end call method ret values 0


[15] var message = Text("Angry Monsters StarterKit")	// create message

            begin set local var
              begin call method
                get local var _E (0 0)
                begin params 2
                  push const string "Text"
                  ,
                  push const string "Angry Monsters StarterKit"
                end params ret values 2
              end call method ret values 1
            end set local var message (3 0)


[16] message.x = this.width	// locate the message at right bottom corner

            begin set property
              begin get property
                push this
                push const string "width"
              end get property ret values 1
              get local var auto create message (3 0)
              push const string "x"
            end set property ret values 0


[17] message.y = this.height

            begin set property
              begin get property
                push this
                push const string "height"
              end get property ret values 1
              get local var auto create message (3 0)
              push const string "y"
            end set property ret values 0


[18] message.anchor = {x=1.05 y=1.05}

            begin set property
              begin object 2
                begin set by name
                  push const number 1.05
                end set by name: [x]
                ,
                begin set by name
                  push const number 1.05
                end set by name: [y]
              end object
              get local var auto create message (3 0)
              push const string "anchor"
            end set property ret values 0


[19] message.shadow = true	// we want shadow enabled

            begin set property
              const true
              get local var auto create message (3 0)
              push const string "shadow"
            end set property ret values 0


[20] this.insert(message)

            begin call method
              push this
              begin params 2
                push const string "insert"
                ,
                get local var message (3 0)
              end params ret values 2
            end call method ret values 0


[22] var animations = { // define animations for our monsters

            begin set local var
              begin object 2

[23] "monster-01.png" = {

                begin set by name
                  begin object 6

[24] generalParams = {

                    begin set by name
                      begin object 4

[25] cols = 9

                        begin set by name
                          push const number 9
                        end set by name: [cols]
                        ,

[26] rows = 10

                        begin set by name
                          push const number 10
                        end set by name: [rows]
                        ,

[27] delay = 0.08

                        begin set by name
                          push const number 0.08
                        end set by name: [delay]
                        ,

[28] rect = {

                        begin set by name
                          begin object 3

[29] center = {x=0.48, y=0.45}

                            begin set by name
                              begin object 2
                                begin set by name
                                  push const number 0.48
                                end set by name: [x]
                                ,
                                begin set by name
                                  push const number 0.45
                                end set by name: [y]
                              end object
                            end set by name: [center]
                            ,

[30] width = 0.5

                            begin set by name
                              push const number 0.5
                            end set by name: [width]
                            ,

[31] height = 0.74

                            begin set by name
                              push const number 0.74
                            end set by name: [height]
                          end object
                        end set by name: [rect]
                      end object
                    end set by name: [generalParams]
                    ,

[34] walkRight 	= { start = 0, frames = 17 }

                    begin set by name
                      begin object 2
                        begin set by name
                          push const number 0
                        end set by name: [start]
                        ,
                        begin set by name
                          push const number 17
                        end set by name: [frames]
                      end object
                    end set by name: [walkRight]
                    ,

[35] walkUp 		= { start = 17, frames = 13 }

                    begin set by name
                      begin object 2
                        begin set by name
                          push const number 17
                        end set by name: [start]
                        ,
                        begin set by name
                          push const number 13
                        end set by name: [frames]
                      end object
                    end set by name: [walkUp]
                    ,

[36] walkDown 	= { start = 30, frames = 12 }

                    begin set by name
                      begin object 2
                        begin set by name
                          push const number 30
                        end set by name: [start]
                        ,
                        begin set by name
                          push const number 12
                        end set by name: [frames]
                      end object
                    end set by name: [walkDown]
                    ,

[37] fightRight 	= { start = 42, frames = 12 }

                    begin set by name
                      begin object 2
                        begin set by name
                          push const number 42
                        end set by name: [start]
                        ,
                        begin set by name
                          push const number 12
                        end set by name: [frames]
                      end object
                    end set by name: [fightRight]
                    ,

[38] dieRight 	= { start = 67, frames = 17 }

                    begin set by name
                      begin object 2
                        begin set by name
                          push const number 67
                        end set by name: [start]
                        ,
                        begin set by name
                          push const number 17
                        end set by name: [frames]
                      end object
                    end set by name: [dieRight]
                  end object
                end set by name: [monster-01.png]
                ,

[40] "monster-03.png" = {

                begin set by name
                  begin object 6

[41] generalParams = {

                    begin set by name
                      begin object 4

[42] cols = 7

                        begin set by name
                          push const number 7
                        end set by name: [cols]
                        ,

[43] rows = 12

                        begin set by name
                          push const number 12
                        end set by name: [rows]
                        ,

[44] delay = 0.08

                        begin set by name
                          push const number 0.08
                        end set by name: [delay]
                        ,

[45] rect = {

                        begin set by name
                          begin object 3

[46] center = {x=0.46 y=0.48}

                            begin set by name
                              begin object 2
                                begin set by name
                                  push const number 0.46
                                end set by name: [x]
                                ,
                                begin set by name
                                  push const number 0.48
                                end set by name: [y]
                              end object
                            end set by name: [center]
                            ,

[47] width = 0.7

                            begin set by name
                              push const number 0.7
                            end set by name: [width]
                            ,

[48] height = 0.8

                            begin set by name
                              push const number 0.8
                            end set by name: [height]
                          end object
                        end set by name: [rect]
                      end object
                    end set by name: [generalParams]
                    ,

[51] walkUp 		= { start = 17, frames = 13 }

                    begin set by name
                      begin object 2
                        begin set by name
                          push const number 17
                        end set by name: [start]
                        ,
                        begin set by name
                          push const number 13
                        end set by name: [frames]
                      end object
                    end set by name: [walkUp]
                    ,

[52] walkRight 	= { start = 0, frames = 17 }

                    begin set by name
                      begin object 2
                        begin set by name
                          push const number 0
                        end set by name: [start]
                        ,
                        begin set by name
                          push const number 17
                        end set by name: [frames]
                      end object
                    end set by name: [walkRight]
                    ,

[53] walkDown 	= { start = 30, frames = 12 }

                    begin set by name
                      begin object 2
                        begin set by name
                          push const number 30
                        end set by name: [start]
                        ,
                        begin set by name
                          push const number 12
                        end set by name: [frames]
                      end object
                    end set by name: [walkDown]
                    ,

[54] fightRight 	= { start = 42, frames = 11 }

                    begin set by name
                      begin object 2
                        begin set by name
                          push const number 42
                        end set by name: [start]
                        ,
                        begin set by name
                          push const number 11
                        end set by name: [frames]
                      end object
                    end set by name: [fightRight]
                    ,

[55] dieRight 	= { start = 70, frames = 11}

                    begin set by name
                      begin object 2
                        begin set by name
                          push const number 70
                        end set by name: [start]
                        ,
                        begin set by name
                          push const number 11
                        end set by name: [frames]
                      end object
                    end set by name: [dieRight]
                  end object
                end set by name: [monster-03.png]
              end object
            end set local var animations (4 0)


[58] for(var filename, anim in animations){ // prepare animations fo usage

            begin scope
              begin locals 4
                5 filename
                6 anim
                12 #func
                13 #valid
              end locals
              new local var filename (5 0)

              new local var anim (6 0)

              new local var #func (12 0 temp)

              new local var #valid (13 0 temp)

              begin code list
                begin set local var
                  begin call method
                    get local var animations (4 0)
                    begin params 1
                      push const string "__iter"
                    end params ret values 1
                  end call method ret values 1
                end set local var #func (12 0 temp)

                begin loop
                  begin set local var
                    begin set local var
                      begin set local var
                        begin call
                          get local var #func (12 0 temp)
                          begin params 0
                          end params ret values 0
                        end call ret values 3
                      end set local var anim (6 0)
                    end set local var filename (5 0)
                  end set local var #valid (13 0 temp)

                  begin if
                    begin bool exp
                      begin logic not
                        get local var #valid (13 0 temp)
                      end logic not
                    end bool exp
                    begin then
                      break
                    end then
                  end if ret values 0


[59] var generalParams = anim.generalParams

                  begin scope
                    begin locals 1
                      7 generalParams
                    end locals
                    begin set local var
                      begin get property
                        get local var anim (6 0)
                        push const string "generalParams"
                      end get property ret values 1
                    end set local var generalParams (7 0)


[60] delete anim.generalParams

                    begin delete
                      get local var anim (6 0)
                      push const string "generalParams"
                    end delete


[61] for(var animName, params in anim){

                    begin scope
                      begin locals 4
                        8 animName
                        9 params
                        10 #func
                        11 #valid
                      end locals
                      new local var animName (8 0)

                      new local var params (9 0)

                      new local var #func (10 0 temp)

                      new local var #valid (11 0 temp)

                      begin code list
                        begin set local var
                          begin call method
                            get local var anim (6 0)
                            begin params 1
                              push const string "__iter"
                            end params ret values 1
                          end call method ret values 1
                        end set local var #func (10 0 temp)

                        begin loop
                          begin set local var
                            begin set local var
                              begin set local var
                                begin call
                                  get local var #func (10 0 temp)
                                  begin params 0
                                  end params ret values 0
                                end call ret values 3
                              end set local var params (9 0)
                            end set local var animName (8 0)
                          end set local var #valid (11 0 temp)

                          begin if
                            begin bool exp
                              begin logic not
                                get local var #valid (11 0 temp)
                              end logic not
                            end bool exp
                            begin then
                              break
                            end then
                          end if ret values 0


[62] anim[animName] = {}.merge(generalParams, params)

                          begin scope
                            begin set property by locals auto create
                              begin call method
                                begin object 0
                                end object
                                begin params 3
                                  push const string "merge"
                                  ,
                                  get local var generalParams (7 0)
                                  ,
                                  get local var params (9 0)
                                end params ret values 3
                              end call method ret values 1
                              get local var auto create anim (6 0)
                              get local var animName (8 0)
                            end set property by locals auto create ret values 0
                          end scope ret values 0
                        end loop ret values 0
                      end code list ret values 0
                    end scope ret values 0
                  end scope ret values 0
                end loop ret values 0
              end code list ret values 0
            end scope ret values 0


[66] var Monster = extends Sprite { // lets create Monster class so we can create a lot of monsters if necessary

            begin set local var
              begin extends
                get env var Sprite
                begin object 9

[67] __object = { // all instances of this class will have following properies by default

                  begin set by name
                    begin object 7

[68] curAnimName = "" // playing animation name

                      begin set by name
                        push const string ""
                      end set by name: [curAnimName]
                      ,

[69] curAnim = null // playing animation object

                      begin set by name
                        const null
                      end set by name: [curAnim]
                      ,

[70] moveTransition = null // move transition object

                      begin set by name
                        const null
                      end set by name: [moveTransition]
                      ,

[71] prevX = 0 // prev x && prev y to track monster speed

                      begin set by name
                        push const number 0
                      end set by name: [prevX]
                      ,

[72] prevY = 0

                      begin set by name
                        push const number 0
                      end set by name: [prevY]
                      ,

[73] health = 100 // monster health

                      begin set by name
                        push const number 100
                      end set by name: [health]
                      ,

[74] fighting = null // monster fighting with

                      begin set by name
                        const null
                      end set by name: [fighting]
                    end object
                  end set by name: [__object]
                  ,

[77] __construct = function(filename){ // Monster class constructor, it's called when you do Monster(...)

                  begin set by name
                    begin function
                      begin locals, total 3
                        0 filename (param)
                        1 _E
                        2 _G
                      end locals

[78] filename = filename || "monster-01.png"

                      begin set local var
                        begin logic ||
                          get local var filename (0 0 param)
                          push const string "monster-01.png"
                        end logic ||
                      end set local var filename (0 0 param)


[79] super(filename) // call constructor of class we extend, so create image

                      begin call
                        super
                        begin params 1
                          get local var filename (0 0 param)
                        end params ret values 1
                      end call ret values 0


[80] this.animations = animations[filename] // save monster animations

                      begin set property
                        begin get property
                          get local var animations (4 1)
                          get local var filename (0 0 param)
                        end get property ret values 1
                        push this
                        push const string "animations"
                      end set property ret values 0


[81] this.setTimeout(this.trackMove, 0.1, true)  // call this.trackMove every 0.1 seconds until we clear this timeout

                      begin call method
                        push this
                        begin params 4
                          push const string "setTimeout"
                          ,
                          begin get property
                            push this
                            push const string "trackMove"
                          end get property ret values 1
                          ,
                          push const number 0.1
                          ,
                          const true
                        end params ret values 4
                      end call method ret values 0


[82] this.runAnimation("walkRight") // run "walkRight" animation by default

                      begin call method
                        push this
                        begin params 2
                          push const string "runAnimation"
                          ,
                          push const string "walkRight"
                        end params ret values 2
                      end call method ret values 0
                    end function
                  end set by name: [__construct]
                  ,

[85] trackMove = function(){ // determine the direction of moving to switch animation

                  begin set by name
                    begin function
                      begin locals, total 5
                        0 _E
                        1 _G
                        2 dx
                        3 dy
                        4 len
                      end locals

[86] if(!this.curAnim || this.fighting) return; // skip if no animation or monster is fighting

                      begin if
                        begin bool exp
                          begin logic ||
                            begin logic not
                              begin get property
                                push this
                                push const string "curAnim"
                              end get property ret values 1
                            end logic not
                            begin get property
                              push this
                              push const string "fighting"
                            end get property ret values 1
                          end logic ||
                        end bool exp
                        begin then
                          return
                        end then
                      end if ret values 0


[87] var dx, dy = this.x - this.prevX, this.y - this.prevY

                      begin set local var
                        begin set local var
                          begin params 2
                            begin operator -
                              begin get property
                                push this
                                push const string "x"
                              end get property ret values 1
                              begin get property
                                push this
                                push const string "prevX"
                              end get property ret values 1
                            end operator -
                            ,
                            begin operator -
                              begin get property
                                push this
                                push const string "y"
                              end get property ret values 1
                              begin get property
                                push this
                                push const string "prevY"
                              end get property ret values 1
                            end operator -
                          end params ret values 2
                        end set local var dy (3 0)
                      end set local var dx (2 0)


[88] this.prevX, this.prevY = this.x, this.y

                      begin set property
                        begin set property
                          begin params 2
                            begin get property
                              push this
                              push const string "x"
                            end get property ret values 1
                            ,
                            begin get property
                              push this
                              push const string "y"
                            end get property ret values 1
                          end params ret values 2
                          push this
                          push const string "prevY"
                        end set property ret values 1
                        push this
                        push const string "prevX"
                      end set property ret values 0


[89] var len = (dx*dx + dy*dy)**0.5 // calculate length of the direction

                      begin set local var
                        begin operator **
                          begin operator +
                            begin binary operator by locals
                              begin operator *
                                get local var dx (2 0)
                                get local var dx (2 0)
                              end operator *
                            end binary operator by locals
                            begin binary operator by locals
                              begin operator *
                                get local var dy (3 0)
                                get local var dy (3 0)
                              end operator *
                            end binary operator by locals
                          end operator +
                          push const number 0.5
                        end operator **
                      end set local var len (4 0)


[90] len > 0 || return;

                      begin pop
                        begin logic ||
                          begin binary operator by local & number
                            begin logic >
                              get local var len (4 0)
                              push const number 0
                            end logic >
                          end binary operator by local & number
                          begin code list
                            return
                          end code list ret values 1
                        end logic ||
                      end pop ret values 0


[91] dx, dy = dx / len, dy / len // normalize the direction

                      begin set local var
                        begin set local var
                          begin params 2
                            begin binary operator by locals
                              begin operator /
                                get local var dx (2 0)
                                get local var len (4 0)
                              end operator /
                            end binary operator by locals
                            ,
                            begin binary operator by locals
                              begin operator /
                                get local var dy (3 0)
                                get local var len (4 0)
                              end operator /
                            end binary operator by locals
                          end params ret values 2
                        end set local var dy (3 0)
                      end set local var dx (2 0)


[92] if(dy < -0.85 && "walkUp" in this.animations){ // monster goes up

                      begin if
                        begin bool exp
                          begin logic &&
                            begin logic <
                              get local var dy (3 0)
                              begin neg
                                push const number 0.85
                              end neg
                            end logic <
                            begin in
                              push const string "walkUp"
                              begin get property
                                push this
                                push const string "animations"
                              end get property ret values 1
                            end in
                          end logic &&
                        end bool exp
                        begin then

[93] this.runAnimation("walkUp")

                          begin scope
                            begin call method
                              push this
                              begin params 2
                                push const string "runAnimation"
                                ,
                                push const string "walkUp"
                              end params ret values 2
                            end call method ret values 0


[94] this.flipX = false

                            begin set property
                              const false
                              push this
                              push const string "flipX"
                            end set property ret values 0
                          end scope ret values 0
                        end then
                        begin else

[95] }else if(dy > 0.85 && "walkDown" in this.animations){ // monster goes down

                          begin if
                            begin bool exp
                              begin logic &&
                                begin binary operator by local & number
                                  begin logic >
                                    get local var dy (3 0)
                                    push const number 0.85
                                  end logic >
                                end binary operator by local & number
                                begin in
                                  push const string "walkDown"
                                  begin get property
                                    push this
                                    push const string "animations"
                                  end get property ret values 1
                                end in
                              end logic &&
                            end bool exp
                            begin then

[96] this.runAnimation("walkDown")

                              begin scope
                                begin call method
                                  push this
                                  begin params 2
                                    push const string "runAnimation"
                                    ,
                                    push const string "walkDown"
                                  end params ret values 2
                                end call method ret values 0


[97] this.flipX = false

                                begin set property
                                  const false
                                  push this
                                  push const string "flipX"
                                end set property ret values 0
                              end scope ret values 0
                            end then
                            begin else

[99] this.runAnimation("walkRight");

                              begin scope
                                begin call method
                                  push this
                                  begin params 2
                                    push const string "runAnimation"
                                    ,
                                    push const string "walkRight"
                                  end params ret values 2
                                end call method ret values 0


[100] this.flipX = dx < 0

                                begin set property
                                  begin binary operator by local & number
                                    begin logic <
                                      get local var dx (2 0)
                                      push const number 0
                                    end logic <
                                  end binary operator by local & number
                                  push this
                                  push const string "flipX"
                                end set property ret values 0
                              end scope ret values 0
                            end else
                          end if ret values 0
                        end else
                      end if ret values 0
                    end function
                  end set by name: [trackMove]
                  ,

[104] runAnimation = function(name, onComplete){ // start needed animation

                  begin set by name
                    begin function
                      begin locals, total 4
                        0 name (param)
                        1 onComplete (param)
                        2 _E
                        3 _G
                      end locals

[105] if(this.curAnimName == name && !onComplete) return; // prevent restarting animation

                      begin if
                        begin bool exp
                          begin logic &&
                            begin logic ==
                              begin get property
                                push this
                                push const string "curAnimName"
                              end get property ret values 1
                              get local var name (0 0 param)
                            end logic ==
                            begin logic not
                              get local var onComplete (1 0 param)
                            end logic not
                          end logic &&
                        end bool exp
                        begin then
                          return
                        end then
                      end if ret values 0


[106] this.curAnimName = name

                      begin set property
                        get local var name (0 0 param)
                        push this
                        push const string "curAnimName"
                      end set property ret values 0


[107] this.stopAnimation(this.curAnim)

                      begin call method
                        push this
                        begin params 2
                          push const string "stopAnimation"
                          ,
                          begin get property
                            push this
                            push const string "curAnim"
                          end get property ret values 1
                        end params ret values 2
                      end call method ret values 0


[108] this.curAnim = this.animation(this.animations[name], onComplete)

                      begin set property
                        begin call method
                          push this
                          begin params 3
                            push const string "animation"
                            ,
                            begin get property
                              begin get property
                                push this
                                push const string "animations"
                              end get property ret values 1
                              get local var name (0 0 param)
                            end get property ret values 1
                            ,
                            get local var onComplete (1 0 param)
                          end params ret values 3
                        end call method ret values 1
                        push this
                        push const string "curAnim"
                      end set property ret values 0
                    end function
                  end set by name: [runAnimation]
                  ,

[111] move = function(x, y, onComplete){ // move monster to position x,y

                  begin set by name
                    begin function
                      begin locals, total 6
                        0 x (param)
                        1 y (param)
                        2 onComplete (param)
                        3 _E
                        4 _G
                        5 len
                      end locals

[112] var len = ((this.x - x)**2 + (this.y - y)**2)**0.5

                      begin set local var
                        begin operator **
                          begin operator +
                            begin operator **
                              begin operator -
                                begin get property
                                  push this
                                  push const string "x"
                                end get property ret values 1
                                get local var x (0 0 param)
                              end operator -
                              push const number 2
                            end operator **
                            begin operator **
                              begin operator -
                                begin get property
                                  push this
                                  push const string "y"
                                end get property ret values 1
                                get local var y (1 0 param)
                              end operator -
                              push const number 2
                            end operator **
                          end operator +
                          push const number 0.5
                        end operator **
                      end set local var len (5 0)


[113] this.stopTransition(this.moveTransition)

                      begin call method
                        push this
                        begin params 2
                          push const string "stopTransition"
                          ,
                          begin get property
                            push this
                            push const string "moveTransition"
                          end get property ret values 1
                        end params ret values 2
                      end call method ret values 0


[114] this.moveTransition = this.transition { // lets use transition to move monster

                      begin set property
                        begin call method
                          push this
                          begin params 2
                            push const string "transition"
                            ,
                            begin object 4

[115] x = x, y = y

                              begin set by name
                                get local var x (0 0 param)
                              end set by name: [x]
                              ,
                              begin set by name
                                get local var y (1 0 param)
                              end set by name: [y]
                              ,

[116] duration = len * 10.0 / director.contentWidth

                              begin set by name
                                begin operator /
                                  begin binary operator by local & number
                                    begin operator *
                                      get local var len (5 0)
                                      push const number 10.0
                                    end operator *
                                  end binary operator by local & number
                                  begin get property
                                    get local var director (2 2)
                                    push const string "contentWidth"
                                  end get property ret values 1
                                end operator /
                              end set by name: [duration]
                              ,

[117] onComplete = onComplete // call this function on complete

                              begin set by name
                                get local var onComplete (2 0 param)
                              end set by name: [onComplete]
                            end object
                          end params ret values 2
                        end call method ret values 1

[114] this.moveTransition = this.transition { // lets use transition to move monster

                        push this
                        push const string "moveTransition"
                      end set property ret values 0
                    end function
                  end set by name: [move]
                  ,

[121] fight = function(other){ // try to fight with other monster

                  begin set by name
                    begin function
                      begin locals, total 6
                        0 other (param)
                        1 _E
                        2 _G
                        3 side
                        4 cx
                        5 cy
                      end locals

[122] if(this.fighting || other.fighting) return; // skip if monster is already fighting

                      begin if
                        begin bool exp
                          begin logic ||
                            begin get property
                              push this
                              push const string "fighting"
                            end get property ret values 1
                            begin get property
                              get local var other (0 0 param)
                              push const string "fighting"
                            end get property ret values 1
                          end logic ||
                        end bool exp
                        begin then
                          return
                        end then
                      end if ret values 0


[123] var side = this.x < other.x ? -1 : 1

                      begin set local var
                        begin question
                          begin bool exp
                            begin logic <
                              begin get property
                                push this
                                push const string "x"
                              end get property ret values 1
                              begin get property
                                get local var other (0 0 param)
                                push const string "x"
                              end get property ret values 1
                            end logic <
                          end bool exp
                          begin then value
                            begin neg
                              push const number 1
                            end neg
                          end then value
                          begin else value
                            push const number 1
                          end else value
                        end question ret values 1
                      end set local var side (3 0)


[124] var cx = (this.x + other.x) / 2

                      begin set local var
                        begin operator /
                          begin operator +
                            begin get property
                              push this
                              push const string "x"
                            end get property ret values 1
                            begin get property
                              get local var other (0 0 param)
                              push const string "x"
                            end get property ret values 1
                          end operator +
                          push const number 2
                        end operator /
                      end set local var cx (4 0)


[125] var cy = (this.y + other.y) / 2

                      begin set local var
                        begin operator /
                          begin operator +
                            begin get property
                              push this
                              push const string "y"
                            end get property ret values 1
                            begin get property
                              get local var other (0 0 param)
                              push const string "y"
                            end get property ret values 1
                          end operator +
                          push const number 2
                        end operator /
                      end set local var cy (5 0)


[127] this.fighting = other

                      begin set property
                        get local var other (0 0 param)
                        push this
                        push const string "fighting"
                      end set property ret values 0


[128] this.move(cx + this.width/2*side, cy, this.startFightingAnimation) // move monster to fighting position

                      begin call method
                        push this
                        begin params 4
                          push const string "move"
                          ,
                          begin operator +
                            get local var cx (4 0)
                            begin operator *
                              begin operator /
                                begin get property
                                  push this
                                  push const string "width"
                                end get property ret values 1
                                push const number 2
                              end operator /
                              get local var side (3 0)
                            end operator *
                          end operator +
                          ,
                          get local var cy (5 0)
                          ,
                          begin get property
                            push this
                            push const string "startFightingAnimation"
                          end get property ret values 1
                        end params ret values 4
                      end call method ret values 0


[130] other.fighting = this

                      begin set property
                        push this
                        get local var auto create other (0 0 param)
                        push const string "fighting"
                      end set property ret values 0


[131] other.move(cx - other.width/2*side, cy, other.startFightingAnimation) // move other monster to fighting position

                      begin call method
                        get local var other (0 0 param)
                        begin params 4
                          push const string "move"
                          ,
                          begin operator -
                            get local var cx (4 0)
                            begin operator *
                              begin operator /
                                begin get property
                                  get local var other (0 0 param)
                                  push const string "width"
                                end get property ret values 1
                                push const number 2
                              end operator /
                              get local var side (3 0)
                            end operator *
                          end operator -
                          ,
                          get local var cy (5 0)
                          ,
                          begin get property
                            get local var other (0 0 param)
                            push const string "startFightingAnimation"
                          end get property ret values 1
                        end params ret values 4
                      end call method ret values 0
                    end function
                  end set by name: [fight]
                  ,

[134] startFightingAnimation = function(){ // start fighting

                  begin set by name
                    begin function
                      begin locals, total 2
                        0 _E
                        1 _G
                      end locals

[135] this.health > 0 || return; // skip if monster is dead

                      begin pop
                        begin logic ||
                          begin logic >
                            begin get property
                              push this
                              push const string "health"
                            end get property ret values 1
                            push const number 0
                          end logic >
                          begin code list
                            return
                          end code list ret values 1
                        end logic ||
                      end pop ret values 0


[136] this.flipX = this.x > this.fighting.x // determine side of monster

                      begin set property
                        begin logic >
                          begin get property
                            push this
                            push const string "x"
                          end get property ret values 1
                          begin get property
                            begin get property
                              push this
                              push const string "fighting"
                            end get property ret values 1
                            push const string "x"
                          end get property ret values 1
                        end logic >
                        push this
                        push const string "flipX"
                      end set property ret values 0


[137] this.runAnimation("fightRight", function(){ // run fighting animations

                      begin call method
                        push this
                        begin params 3
                          push const string "runAnimation"
                          ,
                          push const string "fightRight"
                          ,
                          begin function
                            begin locals, total 2
                              0 _E
                              1 _G
                            end locals

[138] this.fighting.health = this.fighting.health - this.health * 0.3 // make damage to other monster

                            begin set property
                              begin operator -
                                begin get property
                                  begin get property
                                    push this
                                    push const string "fighting"
                                  end get property ret values 1
                                  push const string "health"
                                end get property ret values 1
                                begin operator *
                                  begin get property
                                    push this
                                    push const string "health"
                                  end get property ret values 1
                                  push const number 0.3
                                end operator *
                              end operator -
                              begin get property auto create
                                push this
                                push const string "fighting"
                              end get property auto create ret values 1
                              push const string "health"
                            end set property ret values 0


[139] this.fighting.timeSpeed = math.max(0.7, this.fighting.timeSpeed * 0.8) // damaged monster is tired, so make him slow down

                            begin set property
                              begin call method
                                get env var math
                                begin params 3
                                  push const string "max"
                                  ,
                                  push const number 0.7
                                  ,
                                  begin operator *
                                    begin get property
                                      begin get property
                                        push this
                                        push const string "fighting"
                                      end get property ret values 1
                                      push const string "timeSpeed"
                                    end get property ret values 1
                                    push const number 0.8
                                  end operator *
                                end params ret values 3
                              end call method ret values 1
                              begin get property auto create
                                push this
                                push const string "fighting"
                              end get property auto create ret values 1
                              push const string "timeSpeed"
                            end set property ret values 0


[140] if(this.fighting.health <= 0){ // check if other monster is dead

                            begin if
                              begin bool exp
                                begin logic <=
                                  begin get property
                                    begin get property
                                      push this
                                      push const string "fighting"
                                    end get property ret values 1
                                    push const string "health"
                                  end get property ret values 1
                                  push const number 0
                                end logic <=
                              end bool exp
                              begin then

[141] this.fighting.die() // start die animations

                                begin scope
                                  begin call method
                                    begin get property
                                      push this
                                      push const string "fighting"
                                    end get property ret values 1
                                    begin params 1
                                      push const string "die"
                                    end params ret values 1
                                  end call method ret values 0


[142] this.fighting = null

                                  begin set property
                                    const null
                                    push this
                                    push const string "fighting"
                                  end set property ret values 0


[144] this.move(this.x + math.random(-1, 1) * this.width, this.y + math.random(-1, 1) * this.width)

                                  begin call method
                                    push this
                                    begin params 3
                                      push const string "move"
                                      ,
                                      begin operator +
                                        begin get property
                                          push this
                                          push const string "x"
                                        end get property ret values 1
                                        begin operator *
                                          begin call method
                                            get env var math
                                            begin params 3
                                              push const string "random"
                                              ,
                                              begin neg
                                                push const number 1
                                              end neg
                                              ,
                                              push const number 1
                                            end params ret values 3
                                          end call method ret values 1
                                          begin get property
                                            push this
                                            push const string "width"
                                          end get property ret values 1
                                        end operator *
                                      end operator +
                                      ,
                                      begin operator +
                                        begin get property
                                          push this
                                          push const string "y"
                                        end get property ret values 1
                                        begin operator *
                                          begin call method
                                            get env var math
                                            begin params 3
                                              push const string "random"
                                              ,
                                              begin neg
                                                push const number 1
                                              end neg
                                              ,
                                              push const number 1
                                            end params ret values 3
                                          end call method ret values 1
                                          begin get property
                                            push this
                                            push const string "width"
                                          end get property ret values 1
                                        end operator *
                                      end operator +
                                    end params ret values 3
                                  end call method ret values 0
                                end scope ret values 0
                              end then
                            end if ret values 0
                          end function
                        end params ret values 3
                      end call method ret values 0
                    end function
                  end set by name: [startFightingAnimation]
                  ,

[149] die = function(){ // start dying animations

                  begin set by name
                    begin function
                      begin locals, total 2
                        0 _E
                        1 _G
                      end locals

[150] this.clearTimeout(this.trackMove) // remove this.trackMove timeout functions

                      begin call method
                        push this
                        begin params 2
                          push const string "clearTimeout"
                          ,
                          begin get property
                            push this
                            push const string "trackMove"
                          end get property ret values 1
                        end params ret values 2
                      end call method ret values 0


[151] this.stopTransition(this.moveTransition) // stop moving animations

                      begin call method
                        push this
                        begin params 2
                          push const string "stopTransition"
                          ,
                          begin get property
                            push this
                            push const string "moveTransition"
                          end get property ret values 1
                        end params ret values 2
                      end call method ret values 0


[152] this.flipX = this.x > this.fighting.x // determine side

                      begin set property
                        begin logic >
                          begin get property
                            push this
                            push const string "x"
                          end get property ret values 1
                          begin get property
                            begin get property
                              push this
                              push const string "fighting"
                            end get property ret values 1
                            push const string "x"
                          end get property ret values 1
                        end logic >
                        push this
                        push const string "flipX"
                      end set property ret values 0


[153] this.timeSpeed = 1 // reset time speed to 1

                      begin set property
                        push const number 1
                        push this
                        push const string "timeSpeed"
                      end set property ret values 0


[154] this.runAnimation("dieRight", function(){ // run dying animations

                      begin call method
                        push this
                        begin params 3
                          push const string "runAnimation"
                          ,
                          push const string "dieRight"
                          ,
                          begin function
                            begin locals, total 2
                              0 _E
                              1 _G
                            end locals

[155] this.stopAnimation(this.curAnim)

                            begin call method
                              push this
                              begin params 2
                                push const string "stopAnimation"
                                ,
                                begin get property
                                  push this
                                  push const string "curAnim"
                                end get property ret values 1
                              end params ret values 2
                            end call method ret values 0


[156] this.curAnim = null

                            begin set property
                              const null
                              push this
                              push const string "curAnim"
                            end set property ret values 0


[157] this.transition { // start fade out transition

                            begin call method
                              push this
                              begin params 2
                                push const string "transition"
                                ,
                                begin object 3

[158] opacity = 0

                                  begin set by name
                                    push const number 0
                                  end set by name: [opacity]
                                  ,

[159] duration = 1

                                  begin set by name
                                    push const number 1
                                  end set by name: [duration]
                                  ,

[160] onComplete = function(){

                                  begin set by name
                                    begin function
                                      begin locals, total 2
                                        0 _E
                                        1 _G
                                      end locals

[161] this.remove() // remove monster on the fade out transition completed

                                      begin call method
                                        push this
                                        begin params 1
                                          push const string "remove"
                                        end params ret values 1
                                      end call method ret values 0
                                    end function
                                  end set by name: [onComplete]
                                end object
                              end params ret values 2
                            end call method ret values 0
                          end function
                        end params ret values 3
                      end call method ret values 0
                    end function
                  end set by name: [die]
                  ,

[167] __set@y = function(y){ // track changing y position

                  begin set by name
                    begin function
                      begin locals, total 3
                        0 y (param)
                        1 _E
                        2 _G
                      end locals

[168] super(y) // call the same method of "super" class because we want to add behavior, not override

                      begin call
                        super
                        begin params 1
                          get local var y (0 0 param)
                        end params ret values 1
                      end call ret values 0


[169] this.zOrder = y // set zOrder, so bottom monsters will be front of top monsters

                      begin set property
                        get local var y (0 0 param)
                        push this
                        push const string "zOrder"
                      end set property ret values 0
                    end function
                  end set by name: [__set@y]
                end object
              end extends ret values 1
            end set local var Monster (14 0)


[173] var function color(){ // color random function

            begin set local var
              begin function
                begin locals, total 2
                  0 _E
                  1 _G
                end locals

[174] return [math.random(0.8, 1), math.random(0.8, 1), math.random(0.8, 1)]

                begin return
                  begin array 3
                    begin set auto index
                      begin call method
                        get env var math
                        begin params 3
                          push const string "random"
                          ,
                          push const number 0.8
                          ,
                          push const number 1
                        end params ret values 3
                      end call method ret values 1
                    end set auto index
                    ,
                    begin set auto index
                      begin call method
                        get env var math
                        begin params 3
                          push const string "random"
                          ,
                          push const number 0.8
                          ,
                          push const number 1
                        end params ret values 3
                      end call method ret values 1
                    end set auto index
                    ,
                    begin set auto index
                      begin call method
                        get env var math
                        begin params 3
                          push const string "random"
                          ,
                          push const number 0.8
                          ,
                          push const number 1
                        end params ret values 3
                      end call method ret values 1
                    end set auto index
                  end array
                end return values 1
              end function
            end set local var color (15 0)


[177] var monsters = [] // alive monsters array

            begin set local var
              begin array 0
              end array
            end set local var monsters (16 0)


[178] var scene = this

            begin set local var
              push this
            end set local var scene (17 0)


[179] var monsterNames = animations.keys // save keys of animations object, its are filenames

            begin set local var
              begin get property
                get local var animations (4 0)
                push const string "keys"
              end get property ret values 1
            end set local var monsterNames (18 0)


[180] var function createMonster(i){ // create new monster

            begin set local var
              begin function
                begin locals, total 4
                  0 i (param)
                  1 _E
                  2 _G
                  3 monster
                end locals

[181] i = i || math.random(#monsterNames) // determine random monster name

                begin set local var
                  begin logic ||
                    get local var i (0 0 param)
                    begin call method
                      get env var math
                      begin params 2
                        push const string "random"
                        ,
                        begin length
                          get local var monsterNames (18 1)
                        end length
                      end params ret values 2
                    end call method ret values 1
                  end logic ||
                end set local var i (0 0 param)


[182] var monster = Monster(monsterNames[ i % #monsterNames ]) // create new instance of Monster class

                begin set local var
                  begin call
                    get local var Monster (14 1)
                    begin params 1
                      begin get property
                        get local var monsterNames (18 1)
                        begin operator %
                          get local var i (0 0 param)
                          begin length
                            get local var monsterNames (18 1)
                          end length
                        end operator %
                      end get property ret values 1
                    end params ret values 1
                  end call ret values 1
                end set local var monster (3 0)


[183] monster.x = scene.width * math.random(0.2, 0.8) // set random x position

                begin set property
                  begin operator *
                    begin get property
                      get local var scene (17 1)
                      push const string "width"
                    end get property ret values 1
                    begin call method
                      get env var math
                      begin params 3
                        push const string "random"
                        ,
                        push const number 0.2
                        ,
                        push const number 0.8
                      end params ret values 3
                    end call method ret values 1
                  end operator *
                  get local var auto create monster (3 0)
                  push const string "x"
                end set property ret values 0


[184] monster.y = scene.height * math.random(0.2, 0.8) // set random y position

                begin set property
                  begin operator *
                    begin get property
                      get local var scene (17 1)
                      push const string "height"
                    end get property ret values 1
                    begin call method
                      get env var math
                      begin params 3
                        push const string "random"
                        ,
                        push const number 0.2
                        ,
                        push const number 0.8
                      end params ret values 3
                    end call method ret values 1
                  end operator *
                  get local var auto create monster (3 0)
                  push const string "y"
                end set property ret values 0


[185] monster.timeSpeed = math.random(2.0, 3.0) // set random monster's local time speed

                begin set property
                  begin call method
                    get env var math
                    begin params 3
                      push const string "random"
                      ,
                      push const number 2.0
                      ,
                      push const number 3.0
                    end params ret values 3
                  end call method ret values 1
                  get local var auto create monster (3 0)
                  push const string "timeSpeed"
                end set property ret values 0


[186] monster.color = color() // set random color

                begin set property
                  begin call
                    get local var color (15 1)
                    begin params 0
                    end params ret values 0
                  end call ret values 1
                  get local var auto create monster (3 0)
                  push const string "color"
                end set property ret values 0


[187] monster.opacity = 0 // set initial opacity to zero because of we want run fade in transition

                begin set property
                  push const number 0
                  get local var auto create monster (3 0)
                  push const string "opacity"
                end set property ret values 0


[188] monster.transition { opacity = 1, duration = 1 } // start the fade in transition

                begin call method
                  get local var monster (3 0)
                  begin params 2
                    push const string "transition"
                    ,
                    begin object 2
                      begin set by name
                        push const number 1
                      end set by name: [opacity]
                      ,
                      begin set by name
                        push const number 1
                      end set by name: [duration]
                    end object
                  end params ret values 2
                end call method ret values 0


[189] scene.insert(monster) // insert monster to scene

                begin call method
                  get local var scene (17 1)
                  begin params 2
                    push const string "insert"
                    ,
                    get local var monster (3 0)
                  end params ret values 2
                end call method ret values 0


[190] monsters.push(monster) // save our monster to the alive monsters array

                begin call method
                  get local var monsters (16 1)
                  begin params 2
                    push const string "push"
                    ,
                    get local var monster (3 0)
                  end params ret values 2
                end call method ret values 0


[191] monster.addEventListener("onExit", function(){ // capture onExit event (when monster will be dead)

                begin call method
                  get local var monster (3 0)
                  begin params 3
                    push const string "addEventListener"
                    ,
                    push const string "onExit"
                    ,
                    begin function
                      begin locals, total 6
                        0 _E
                        1 _G
                      end locals

[192] for(var i, m in monsters){

                      begin scope
                        begin locals 4
                          2 i
                          3 m
                          4 #func
                          5 #valid
                        end locals
                        new local var i (2 0)

                        new local var m (3 0)

                        new local var #func (4 0 temp)

                        new local var #valid (5 0 temp)

                        begin code list
                          begin set local var
                            begin call method
                              get local var monsters (16 2)
                              begin params 1
                                push const string "__iter"
                              end params ret values 1
                            end call method ret values 1
                          end set local var #func (4 0 temp)

                          begin loop
                            begin set local var
                              begin set local var
                                begin set local var
                                  begin call
                                    get local var #func (4 0 temp)
                                    begin params 0
                                    end params ret values 0
                                  end call ret values 3
                                end set local var m (3 0)
                              end set local var i (2 0)
                            end set local var #valid (5 0 temp)

                            begin if
                              begin bool exp
                                begin logic not
                                  get local var #valid (5 0 temp)
                                end logic not
                              end bool exp
                              begin then
                                break
                              end then
                            end if ret values 0


[193] if(m === this){ // find monster inside of to the alive monsters array

                            begin scope
                              begin if
                                begin bool exp
                                  begin logic ===
                                    get local var m (3 0)
                                    push this
                                  end logic ===
                                end bool exp
                                begin then

[194] delete monsters[i] // remove it

                                  begin scope
                                    begin delete
                                      get local var monsters (16 2)
                                      get local var i (2 0)
                                    end delete


[195] createMonster(math.random(#monsterNames)) // create new monster

                                    begin call
                                      get local var createMonster (19 2)
                                      begin params 1
                                        begin call method
                                          get env var math
                                          begin params 2
                                            push const string "random"
                                            ,
                                            begin length
                                              get local var monsterNames (18 2)
                                            end length
                                          end params ret values 2
                                        end call method ret values 1
                                      end params ret values 1
                                    end call ret values 0


[196] return;

                                    return
                                  end scope ret values 0
                                end then
                              end if ret values 0
                            end scope ret values 0
                          end loop ret values 0
                        end code list ret values 0
                      end scope ret values 0
                    end function
                  end params ret values 3
                end call method ret values 0
              end function
            end set local var createMonster (19 0)


[202] for(var i = 0; i < 20; i++){ // create initial monsters

            begin scope
              begin locals 1
                20 i
              end locals
              begin set local var
                push const number 0
              end set local var i (20 0)

              begin loop
                begin if
                  begin bool exp
                    begin logic not
                      begin binary operator by local & number
                        begin logic <
                          get local var i (20 0)
                          push const number 20
                        end logic <
                      end binary operator by local & number
                    end logic not
                  end bool exp
                  begin then
                    break
                  end then
                end if ret values 0


[203] createMonster()

                begin scope
                  begin call
                    get local var createMonster (19 0)
                    begin params 0
                    end params ret values 0
                  end call ret values 0
                end scope ret values 0


[202] for(var i = 0; i < 20; i++){ // create initial monsters

                begin code list
                  begin set local var by bin operator local & number
                    begin binary operator by local & number
                      begin operator +
                        get local var i (20 0)
                        push const number 1
                      end operator +
                    end binary operator by local & number
                  end set local var by bin operator local & number i (20 0)
                end code list ret values 0
              end loop ret values 0
            end scope ret values 0


[206] var function moveMonsters(x, y){ // move monsters to the touched position

            begin set local var
              begin function
                begin locals, total 8
                  0 x (param)
                  1 y (param)
                  2 _E
                  3 _G
                end locals

[207] for(var i, monster in monsters){

                begin scope
                  begin locals 4
                    4 i
                    5 monster
                    6 #func
                    7 #valid
                  end locals
                  new local var i (4 0)

                  new local var monster (5 0)

                  new local var #func (6 0 temp)

                  new local var #valid (7 0 temp)

                  begin code list
                    begin set local var
                      begin call method
                        get local var monsters (16 1)
                        begin params 1
                          push const string "__iter"
                        end params ret values 1
                      end call method ret values 1
                    end set local var #func (6 0 temp)

                    begin loop
                      begin set local var
                        begin set local var
                          begin set local var
                            begin call
                              get local var #func (6 0 temp)
                              begin params 0
                              end params ret values 0
                            end call ret values 3
                          end set local var monster (5 0)
                        end set local var i (4 0)
                      end set local var #valid (7 0 temp)

                      begin if
                        begin bool exp
                          begin logic not
                            get local var #valid (7 0 temp)
                          end logic not
                        end bool exp
                        begin then
                          break
                        end then
                      end if ret values 0


[208] if(!monster.fighting) monster.move(x, y)

                      begin scope
                        begin if
                          begin bool exp
                            begin logic not
                              begin get property
                                get local var monster (5 0)
                                push const string "fighting"
                              end get property ret values 1
                            end logic not
                          end bool exp
                          begin then
                            begin call method
                              get local var monster (5 0)
                              begin params 3
                                push const string "move"
                                ,
                                get local var x (0 0 param)
                                ,
                                get local var y (1 0 param)
                              end params ret values 3
                            end call method ret values 0
                          end then
                        end if ret values 0
                      end scope ret values 0
                    end loop ret values 0
                  end code list ret values 0
                end scope ret values 0
              end function
            end set local var moveMonsters (21 0)


[212] this.addEventListener("touch", function(touch){

            begin call method
              push this
              begin params 3
                push const string "addEventListener"
                ,
                push const string "touch"
                ,
                begin function
                  begin locals, total 3
                    0 touch (param)
                    1 _E
                    2 _G
                  end locals

[213] moveMonsters(touch.local.x, touch.local.y)

                  begin call
                    get local var moveMonsters (21 1)
                    begin params 2
                      begin get property
                        begin get property
                          get local var touch (0 0 param)
                          push const string "local"
                        end get property ret values 1
                        push const string "x"
                      end get property ret values 1
                      ,
                      begin get property
                        begin get property
                          get local var touch (0 0 param)
                          push const string "local"
                        end get property ret values 1
                        push const string "y"
                      end get property ret values 1
                    end params ret values 2
                  end call ret values 0
                end function
              end params ret values 3
            end call method ret values 0


[216] this.setTimeout(function(){ // set new timeout function to check monsters crossed

            begin call method
              push this
              begin params 4
                push const string "setTimeout"
                ,
                begin function
                  begin locals, total 9
                    0 _E
                    1 _G
                  end locals

[217] for(var i, monster in monsters){

                  begin scope
                    begin locals 4
                      2 i
                      3 monster
                      7 #func
                      8 #valid
                    end locals
                    new local var i (2 0)

                    new local var monster (3 0)

                    new local var #func (7 0 temp)

                    new local var #valid (8 0 temp)

                    begin code list
                      begin set local var
                        begin call method
                          get local var monsters (16 1)
                          begin params 1
                            push const string "__iter"
                          end params ret values 1
                        end call method ret values 1
                      end set local var #func (7 0 temp)

                      begin loop
                        begin set local var
                          begin set local var
                            begin set local var
                              begin call
                                get local var #func (7 0 temp)
                                begin params 0
                                end params ret values 0
                              end call ret values 3
                            end set local var monster (3 0)
                          end set local var i (2 0)
                        end set local var #valid (8 0 temp)

                        begin if
                          begin bool exp
                            begin logic not
                              get local var #valid (8 0 temp)
                            end logic not
                          end bool exp
                          begin then
                            break
                          end then
                        end if ret values 0


[218] if(monster.fighting) continue

                        begin scope
                          begin if
                            begin bool exp
                              begin get property
                                get local var monster (3 0)
                                push const string "fighting"
                              end get property ret values 1
                            end bool exp
                            begin then
                              continue
                            end then
                          end if ret values 0


[219] for(var j = i+1; j < #monsters; j++){

                          begin scope
                            begin locals 1
                              4 j
                            end locals
                            begin set local var by bin operator local & number
                              begin binary operator by local & number
                                begin operator +
                                  get local var i (2 0)
                                  push const number 1
                                end operator +
                              end binary operator by local & number
                            end set local var by bin operator local & number j (4 0)

                            begin loop
                              begin if
                                begin bool exp
                                  begin logic not
                                    begin logic <
                                      get local var j (4 0)
                                      begin length
                                        get local var monsters (16 1)
                                      end length
                                    end logic <
                                  end logic not
                                end bool exp
                                begin then
                                  break
                                end then
                              end if ret values 0


[220] var other = monsters[j]

                              begin scope
                                begin locals 2
                                  5 other
                                  6 dist
                                end locals
                                begin set local var
                                  begin get property
                                    get local var monsters (16 1)
                                    get local var j (4 0)
                                  end get property ret values 1
                                end set local var other (5 0)


[221] var dist = ((monster.x - other.x)**2 + (monster.y - other.y)**2)**0.5

                                begin set local var
                                  begin operator **
                                    begin operator +
                                      begin operator **
                                        begin operator -
                                          begin get property
                                            get local var monster (3 0)
                                            push const string "x"
                                          end get property ret values 1
                                          begin get property
                                            get local var other (5 0)
                                            push const string "x"
                                          end get property ret values 1
                                        end operator -
                                        push const number 2
                                      end operator **
                                      begin operator **
                                        begin operator -
                                          begin get property
                                            get local var monster (3 0)
                                            push const string "y"
                                          end get property ret values 1
                                          begin get property
                                            get local var other (5 0)
                                            push const string "y"
                                          end get property ret values 1
                                        end operator -
                                        push const number 2
                                      end operator **
                                    end operator +
                                    push const number 0.5
                                  end operator **
                                end set local var dist (6 0)


[222] if(dist < monster.width){ // are monsters close to each other to fight

                                begin if
                                  begin bool exp
                                    begin logic <
                                      get local var dist (6 0)
                                      begin get property
                                        get local var monster (3 0)
                                        push const string "width"
                                      end get property ret values 1
                                    end logic <
                                  end bool exp
                                  begin then

[223] monster.fight(other)

                                    begin scope
                                      begin call method
                                        get local var monster (3 0)
                                        begin params 2
                                          push const string "fight"
                                          ,
                                          get local var other (5 0)
                                        end params ret values 2
                                      end call method ret values 0
                                    end scope ret values 0
                                  end then
                                end if ret values 0
                              end scope ret values 0


[219] for(var j = i+1; j < #monsters; j++){

                              begin code list
                                begin set local var by bin operator local & number
                                  begin binary operator by local & number
                                    begin operator +
                                      get local var j (4 0)
                                      push const number 1
                                    end operator +
                                  end binary operator by local & number
                                end set local var by bin operator local & number j (4 0)
                              end code list ret values 0
                            end loop ret values 0
                          end scope ret values 0
                        end scope ret values 0
                      end loop ret values 0
                    end code list ret values 0
                  end scope ret values 0
                end function
                ,

[227] }, 0.3, true) // call the timeout each 0.3 seconds forever

                push const number 0.3
                ,
                const true
              end params ret values 4
            end call method ret values 0
          end function
        end set by name: [__construct]
      end object
    end extends ret values 1
  end set env var MyScene


[231] director.scene = MyScene()	// create and set our game scene

  begin set property
    begin call method
      get local var _E (0 0)
      begin params 1
        push const string "MyScene"
      end params ret values 1
    end call method ret values 1
    get local var auto create director (2 0)
    push const string "scene"
  end set property ret values 0

  begin code list
    begin return
      get local var _E (0 0)
    end return values 1
  end code list ret values 0
end function
