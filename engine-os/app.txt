
[FILE] raw://../../engine-os/app.os
[1] require("constants")

begin function
  begin locals, total 3
    0 _E
    1 _G
    2 autoTouchId
  end locals
  begin call method
    get local var _E (0 0)
    begin params 2
      push const string "require"
      ,
      push const string "constants"
    end params ret values 2
  end call method ret values 0


[5] _E = _G.app // extends C++ namespace

  begin set local var
    begin get property
      get local var _G (1 0)
      push const string "app"
    end get property ret values 1
  end set local var _E (0 0)


[7] function get screenSize(){

  begin set env var
    begin function
      begin locals, total 2
        0 _E
        1 _G
      end locals

[8] return Size(this.screenWidth this.screenHeight)

      begin tail call method
        get local var _E (0 0)
        begin params 3
          push const string "Size"
          ,
          begin get property
            push this
            push const string "screenWidth"
          end get property ret values 1
          ,
          begin get property
            push this
            push const string "screenHeight"
          end get property ret values 1
        end params ret values 3
      end tail call method
    end function
  end set env var __get@screenSize


[11] orientation = ORIENTATION_PORTRAIT

  begin set env var
    get env var ORIENTATION_PORTRAIT
  end set env var orientation


[13] touchEvents = {}

  begin set env var
    begin object 0
    end object
  end set env var touchEvents


[14] keyEvents = {}

  begin set env var
    begin object 0
    end object
  end set env var keyEvents


[16] function registerKeyEvent(key pressed){

  begin set env var
    begin function
      begin locals, total 4
        0 key (param)
        1 pressed (param)
        2 _E
        3 _G
      end locals

[17] if(key in keyEvents){

      begin if
        begin bool exp
          begin in
            get local var key (0 0 param)
            get env var keyEvents
          end in
        end bool exp
        begin then

[18] keyEvents[key].pressed = pressed

          begin scope
            begin set property
              get local var pressed (1 0 param)
              begin get property auto create
                get env var auto create keyEvents
                get local var key (0 0 param)
              end get property auto create ret values 1
              push const string "pressed"
            end set property ret values 0


[19] return

            return
          end scope ret values 0
        end then
      end if ret values 0


[21] keyEvents[key] = {

      begin set property
        begin object 5

[22] key = key

          begin set by name
            get local var key (0 0 param)
          end set by name: [key]
          ,

[23] pressed = pressed

          begin set by name
            get local var pressed (1 0 param)
          end set by name: [pressed]
          ,

[24] processed = false

          begin set by name
            const false
          end set by name: [processed]
          ,

[25] captured = null

          begin set by name
            const null
          end set by name: [captured]
          ,

[26] capturedFunc = null

          begin set by name
            const null
          end set by name: [capturedFunc]
        end object

[21] keyEvents[key] = {

        get env var auto create keyEvents
        get local var key (0 0 param)
      end set property ret values 0
    end function
  end set env var registerKeyEvent


[30] var autoTouchId = 0

  begin set local var
    push const number 0
  end set local var autoTouchId (2 0)


[31] function registerTouchEvent(x y phase id){

  begin set env var
    begin function
      begin locals, total 7
        0 x (param)
        1 y (param)
        2 phase (param)
        3 id (param)
        4 _E
        5 _G
        6 touch
      end locals

[32] if(id == 0){

      begin if
        begin bool exp
          begin binary operator by local & number
            begin logic ==
              get local var id (3 0 param)
              push const number 0
            end logic ==
          end binary operator by local & number
        end bool exp
        begin then

[33] id = phase == "start" ? --autoTouchId : autoTouchId

          begin scope
            begin set local var
              begin question
                begin bool exp
                  begin logic ==
                    get local var phase (2 0 param)
                    push const string "start"
                  end logic ==
                end bool exp
                begin then value
                  begin code list
                    begin set local var
                      begin operator -
                        get local var autoTouchId (2 1)
                        push const number 1
                      end operator -
                    end set local var autoTouchId (2 1)

                    get local var autoTouchId (2 1)
                  end code list ret values 1
                end then value
                begin else value
                  get local var autoTouchId (2 1)
                end else value
              end question ret values 1
            end set local var id (3 0 param)
          end scope ret values 0
        end then
      end if ret values 0


[35] if(phase == "start"){

      begin if
        begin bool exp
          begin logic ==
            get local var phase (2 0 param)
            push const string "start"
          end logic ==
        end bool exp
        begin then

[36] touchEvents[id] = {

          begin scope
            begin set property
              begin object 7

[37] x = x

                begin set by name
                  get local var x (0 0 param)
                end set by name: [x]
                ,

[38] y = y

                begin set by name
                  get local var y (1 0 param)
                end set by name: [y]
                ,

[39] phase = phase

                begin set by name
                  get local var phase (2 0 param)
                end set by name: [phase]
                ,

[40] processed = false

                begin set by name
                  const false
                end set by name: [processed]
                ,

[41] id = id

                begin set by name
                  get local var id (3 0 param)
                end set by name: [id]
                ,

[42] captured = null

                begin set by name
                  const null
                end set by name: [captured]
                ,

[43] capturedFunc = null

                begin set by name
                  const null
                end set by name: [capturedFunc]
              end object

[36] touchEvents[id] = {

              get env var auto create touchEvents
              get local var id (3 0 param)
            end set property ret values 0


[45] return

            return
          end scope ret values 0
        end then
      end if ret values 0


[47] if(!(id in touchEvents)){

      begin if
        begin bool exp
          begin logic not
            begin in
              get local var id (3 0 param)
              get env var touchEvents
            end in
          end logic not
        end bool exp
        begin then

[48] return

          begin scope
            return
          end scope ret values 0
        end then
      end if ret values 0


[50] var touch = touchEvents[id]

      begin set local var
        begin get property
          get env var touchEvents
          get local var id (3 0 param)
        end get property ret values 1
      end set local var touch (6 0)


[51] if(phase == "move"){

      begin if
        begin bool exp
          begin logic ==
            get local var phase (2 0 param)
            push const string "move"
          end logic ==
        end bool exp
        begin then

[52] if(touch.phase == "start"){

          begin scope
            begin if
              begin bool exp
                begin logic ==
                  begin get property
                    get local var touch (6 0)
                    push const string "phase"
                  end get property ret values 1
                  push const string "start"
                end logic ==
              end bool exp
              begin then

[53] if(!touch.processed){

                begin scope
                  begin if
                    begin bool exp
                      begin logic not
                        begin get property
                          get local var touch (6 0)
                          push const string "processed"
                        end get property ret values 1
                      end logic not
                    end bool exp
                    begin then

[54] touch.x = x

                      begin scope
                        begin set property
                          get local var x (0 0 param)
                          get local var auto create touch (6 0)
                          push const string "x"
                        end set property ret values 0


[55] touch.y = y

                        begin set property
                          get local var y (1 0 param)
                          get local var auto create touch (6 0)
                          push const string "y"
                        end set property ret values 0


[56] return

                        return
                      end scope ret values 0
                    end then
                  end if ret values 0
                end scope ret values 0
              end then
              begin else

[58] }else if(touch.phase != "move"){

                begin if
                  begin bool exp
                    begin logic !=
                      begin get property
                        get local var touch (6 0)
                        push const string "phase"
                      end get property ret values 1
                      push const string "move"
                    end logic !=
                  end bool exp
                  begin then

[59] return

                    begin scope
                      return
                    end scope ret values 0
                  end then
                end if ret values 0
              end else
            end if ret values 0
          end scope ret values 0
        end then
      end if ret values 0


[62] touch.x = x

      begin set property
        get local var x (0 0 param)
        get local var auto create touch (6 0)
        push const string "x"
      end set property ret values 0


[63] touch.y = y

      begin set property
        get local var y (1 0 param)
        get local var auto create touch (6 0)
        push const string "y"
      end set property ret values 0


[64] touch.phase = phase

      begin set property
        get local var phase (2 0 param)
        get local var auto create touch (6 0)
        push const string "phase"
      end set property ret values 0


[65] touch.processed = false

      begin set property
        const false
        get local var auto create touch (6 0)
        push const string "processed"
      end set property ret values 0


[66] touch.id = id

      begin set property
        get local var id (3 0 param)
        get local var auto create touch (6 0)
        push const string "id"
      end set property ret values 0
    end function
  end set env var registerTouchEvent


[67] }

  begin code list
    begin return
      get local var _E (0 0)
    end return values 1
  end code list ret values 0
end function
